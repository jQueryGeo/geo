/*! jQuery Geo - v1.1.0 - 2018-10-06
* http://jquerygeo.com
* Copyright (c) 2018 Ryan Morrison-Westphal; Licensed MIT */
document.createElement("canvas").getContext||function(){function a(){return this.context_||(this.context_=new q(this))}function b(a,b,c){var d=G.call(arguments,2);return function(){return a.apply(b,d.concat(G.call(arguments)))}}function c(a,b,c){a.namespaces[b]||a.namespaces.add(b,c,"#default#VML")}function d(a){if(c(a,"g_vml_","urn:schemas-microsoft-com:vml"),c(a,"g_o_","urn:schemas-microsoft-com:office:office"),!a.styleSheets.ex_canvas_){var b=a.createStyleSheet();b.owningElement.id="ex_canvas_",b.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function e(a){var b=a.srcElement;switch(a.propertyName){case"width":b.getContext().clearRect(),b.style.width=b.attributes.width.nodeValue+"px",b.firstChild.style.width=b.clientWidth+"px";break;case"height":b.getContext().clearRect(),b.style.height=b.attributes.height.nodeValue+"px",b.firstChild.style.height=b.clientHeight+"px"}}function f(a){var b=a.srcElement;b.firstChild&&(b.firstChild.style.width=b.clientWidth+"px",b.firstChild.style.height=b.clientHeight+"px")}function g(){return[[1,0,0],[0,1,0],[0,0,1]]}function h(a,b){for(var c=g(),d=0;d<3;d++)for(var e=0;e<3;e++){for(var f=0,h=0;h<3;h++)f+=a[d][h]*b[h][e];c[d][e]=f}return c}function i(a,b){b.fillStyle=a.fillStyle,b.lineCap=a.lineCap,b.lineJoin=a.lineJoin,b.lineWidth=a.lineWidth,b.miterLimit=a.miterLimit,b.shadowBlur=a.shadowBlur,b.shadowColor=a.shadowColor,b.shadowOffsetX=a.shadowOffsetX,b.shadowOffsetY=a.shadowOffsetY,b.strokeStyle=a.strokeStyle,b.globalAlpha=a.globalAlpha,b.font=a.font,b.textAlign=a.textAlign,b.textBaseline=a.textBaseline,b.arcScaleX_=a.arcScaleX_,b.arcScaleY_=a.arcScaleY_,b.lineScale_=a.lineScale_}function j(a){var b=a.indexOf("(",3),c=a.indexOf(")",b+1),d=a.substring(b+1,c).split(",");return 4==d.length&&"a"==a.charAt(3)||(d[3]=1),d}function k(a){return parseFloat(a)/100}function l(a,b,c){return Math.min(c,Math.max(b,a))}function m(a){var b,c,d,e,f,g;if(e=parseFloat(a[0])/360%360,e<0&&e++,f=l(k(a[1]),0,1),g=l(k(a[2]),0,1),0==f)b=c=d=g;else{var h=g<.5?g*(1+f):g+f-g*f,i=2*g-h;b=n(i,h,e+1/3),c=n(i,h,e),d=n(i,h,e-1/3)}return"#"+I[Math.floor(255*b)]+I[Math.floor(255*c)]+I[Math.floor(255*d)]}function n(a,b,c){return c<0&&c++,c>1&&c--,6*c<1?a+6*(b-a)*c:2*c<1?b:3*c<2?a+(b-a)*(2/3-c)*6:a}function o(a){if(a in L)return L[a];var b,c=1;if(a=String(a),"#"==a.charAt(0))b=a;else if(/^rgb/.test(a)){for(var d,e=j(a),b="#",f=0;f<3;f++)d=-1!=e[f].indexOf("%")?Math.floor(255*k(e[f])):+e[f],b+=I[l(d,0,255)];c=+e[3]}else if(/^hsl/.test(a)){var e=j(a);b=m(e),c=e[3]}else b=a;return L[a]={color:b,alpha:c}}function p(a){return M[a]||"square"}function q(a){this.m_=g(),this.mStack_=[],this.aStack_=[],this.currentPath_=[],this.strokeStyle="#000",this.fillStyle="#000",this.lineWidth=1,this.lineJoin="miter",this.lineCap="butt",this.miterLimit=1*E,this.globalAlpha=1,this.canvas=a;var b="width:"+a.clientWidth+"px;height:"+a.clientHeight+"px;overflow:hidden;position:absolute",c=a.ownerDocument.createElement("div");c.style.cssText=b,a.appendChild(c);var d=c.cloneNode(!1);d.style.backgroundColor="red",d.style.filter="alpha(opacity=0)",a.appendChild(d),this.element_=c,this.arcScaleX_=1,this.arcScaleY_=1,this.lineScale_=1}function r(a,b,c,d){a.currentPath_.push({type:"bezierCurveTo",cp1x:b.x,cp1y:b.y,cp2x:c.x,cp2y:c.y,x:d.x,y:d.y}),a.currentX_=d.x,a.currentY_=d.y}function s(a,b){var c=o(a.strokeStyle),d=c.color,e=c.alpha*a.globalAlpha,f=a.lineScale_*a.lineWidth;f<1&&(e*=f),b.push("<g_vml_:stroke",' opacity="',e,'"',' joinstyle="',a.lineJoin,'"',' miterlimit="',a.miterLimit,'"',' endcap="',p(a.lineCap),'"',' weight="',f,'px"',' color="',d,'" />')}function t(a,b,c,d){var e=(a.fillStyle,a.arcScaleX_,a.arcScaleY_,d.x,c.x,d.y,c.y,o(a.fillStyle)),f=e.color,g=e.alpha*a.globalAlpha;b.push('<g_vml_:fill color="',f,'" opacity="',g,'" />')}function u(a,b,c){var d=a.m_;return{x:E*(b*d[0][0]+c*d[1][0]+d[2][0])-F,y:E*(b*d[0][1]+c*d[1][1]+d[2][1])-F}}function v(a){return isFinite(a[0][0])&&isFinite(a[0][1])&&isFinite(a[1][0])&&isFinite(a[1][1])&&isFinite(a[2][0])&&isFinite(a[2][1])}function w(a,b,c){if(v(b)&&(a.m_=b,c)){var d=b[0][0]*b[1][1]-b[0][1]*b[1][0];a.lineScale_=D(C(d))}}function x(a){this.code=this[a],this.message=a+": DOM Exception "+this.code}var y=Math,z=y.round,A=y.sin,B=y.cos,C=y.abs,D=y.sqrt,E=10,F=E/2,G=(navigator.userAgent.match(/MSIE ([\d.]+)?/)[1],Array.prototype.slice);d(document);var H={init:function(a){var c=a||document;c.createElement("canvas"),c.attachEvent("onreadystatechange",b(this.init_,this,c))},init_:function(a){for(var b=a.getElementsByTagName("canvas"),c=0;c<b.length;c++)this.initElement(b[c])},initElement:function(b){if(!b.getContext){b.getContext=a,d(b.ownerDocument),b.innerHTML="",b.attachEvent("onpropertychange",e),b.attachEvent("onresize",f);var c=b.attributes;c.width&&c.width.specified?b.style.width=c.width.nodeValue+"px":b.width=b.clientWidth,c.height&&c.height.specified?b.style.height=c.height.nodeValue+"px":b.height=b.clientHeight}return b}};H.init();for(var I=[],J=0;J<16;J++)for(var K=0;K<16;K++)I[16*J+K]=J.toString(16)+K.toString(16);var L={},M={butt:"flat",round:"round"},N=q.prototype;N.clearRect=function(){this.textMeasureEl_&&(this.textMeasureEl_.removeNode(!0),this.textMeasureEl_=null),this.element_.innerHTML=""},N.beginPath=function(){this.currentPath_=[]},N.moveTo=function(a,b){var c=u(this,a,b);this.currentPath_.push({type:"moveTo",x:c.x,y:c.y}),this.currentX_=c.x,this.currentY_=c.y},N.lineTo=function(a,b){var c=u(this,a,b);this.currentPath_.push({type:"lineTo",x:c.x,y:c.y}),this.currentX_=c.x,this.currentY_=c.y},N.bezierCurveTo=function(a,b,c,d,e,f){var g=u(this,e,f);r(this,u(this,a,b),u(this,c,d),g)},N.quadraticCurveTo=function(a,b,c,d){var e=u(this,a,b),f=u(this,c,d),g={x:this.currentX_+2/3*(e.x-this.currentX_),y:this.currentY_+2/3*(e.y-this.currentY_)};r(this,g,{x:g.x+(f.x-this.currentX_)/3,y:g.y+(f.y-this.currentY_)/3},f)},N.arc=function(a,b,c,d,e,f){c*=E;var g=f?"at":"wa",h=a+B(d)*c-F,i=b+A(d)*c-F,j=a+B(e)*c-F,k=b+A(e)*c-F;h!=j||f||(h+=.125);var l=u(this,a,b),m=u(this,h,i),n=u(this,j,k);this.currentPath_.push({type:g,x:l.x,y:l.y,radius:c,xStart:m.x,yStart:m.y,xEnd:n.x,yEnd:n.y})},N.stroke=function(a){var b=[],c=10,d=10;b.push("<g_vml_:shape",' filled="',!!a,'"',' style="position:absolute;width:',c,"px;height:",d,'px;"',' coordorigin="0,0"',' coordsize="',E*c,",",E*d,'"',' stroked="',!a,'"',' path="');for(var e={x:null,y:null},f={x:null,y:null},g=0;g<this.currentPath_.length;g++){var h=this.currentPath_[g];switch(h.type){case"moveTo":h,b.push(" m ",z(h.x),",",z(h.y));break;case"lineTo":b.push(" l ",z(h.x),",",z(h.y));break;case"close":b.push(" x "),h=null;break;case"bezierCurveTo":b.push(" c ",z(h.cp1x),",",z(h.cp1y),",",z(h.cp2x),",",z(h.cp2y),",",z(h.x),",",z(h.y));break;case"at":case"wa":b.push(" ",h.type," ",z(h.x-this.arcScaleX_*h.radius),",",z(h.y-this.arcScaleY_*h.radius)," ",z(h.x+this.arcScaleX_*h.radius),",",z(h.y+this.arcScaleY_*h.radius)," ",z(h.xStart),",",z(h.yStart)," ",z(h.xEnd),",",z(h.yEnd))}h&&((null==e.x||h.x<e.x)&&(e.x=h.x),(null==f.x||h.x>f.x)&&(f.x=h.x),(null==e.y||h.y<e.y)&&(e.y=h.y),(null==f.y||h.y>f.y)&&(f.y=h.y))}b.push(' ">'),a?t(this,b,e,f):s(this,b),b.push("</g_vml_:shape>"),this.element_.insertAdjacentHTML("beforeEnd",b.join(""))},N.fill=function(){this.stroke(!0)},N.closePath=function(){this.currentPath_.push({type:"close"})},N.save=function(){var a={};i(this,a),this.aStack_.push(a),this.mStack_.push(this.m_),this.m_=h(g(),this.m_)},N.restore=function(){this.aStack_.length&&(i(this.aStack_.pop(),this),this.m_=this.mStack_.pop())},N.translate=function(a,b){w(this,h([[1,0,0],[0,1,0],[a,b,1]],this.m_),!1)},N.scale=function(a,b){this.arcScaleX_*=a,this.arcScaleY_*=b,w(this,h([[a,0,0],[0,b,0],[0,0,1]],this.m_),!0)};var O=x.prototype=new Error;O.INDEX_SIZE_ERR=1,O.DOMSTRING_SIZE_ERR=2,O.HIERARCHY_REQUEST_ERR=3,O.WRONG_DOCUMENT_ERR=4,O.INVALID_CHARACTER_ERR=5,O.NO_DATA_ALLOWED_ERR=6,O.NO_MODIFICATION_ALLOWED_ERR=7,O.NOT_FOUND_ERR=8,O.NOT_SUPPORTED_ERR=9,O.INUSE_ATTRIBUTE_ERR=10,O.INVALID_STATE_ERR=11,O.SYNTAX_ERR=12,O.INVALID_MODIFICATION_ERR=13,O.NAMESPACE_ERR=14,O.INVALID_ACCESS_ERR=15,O.VALIDATION_ERR=16,O.TYPE_MISMATCH_ERR=17,G_vmlCanvasManager=H,CanvasRenderingContext2D=q,DOMException=x}(),this.jsviews||this.jQuery&&jQuery.views||function(a,b){function c(a,b){var c="\\"+a.charAt(0),d="\\"+a.charAt(1),e="\\"+b.charAt(0),f="\\"+b.charAt(1);return Q.rTag=u=d+"(?:(?:(\\w+(?=[\\/\\s"+e+"]))|(?:(\\w+)?(:)|(>)|(\\*)))\\s*((?:[^"+e+"]|"+e+"(?!"+f+"))*?)(\\/)?|(?:\\/(\\w+)))"+e,u=new RegExp(c+u+f,"g"),v=new RegExp("<.*>|"+a+".*"+b),this}function d(a){var c=this,d=c.tmpl.helpers||{};return a=(c.ctx[a]!==b?c.ctx:d[a]!==b?d:k[a]!==b?k:{})[a],"function"!=typeof a?a:function(){return a.apply(c,arguments)}}function e(a,b,c){var d=b.tmpl.converters;return a=d&&d[a]||l[a],a?a.call(b,c):c}function f(a,c,d,e,f){f.props=f.props||{};var g,h=f.props.tmpl,k=c.tmpl.tags,l=c.tmpl.templates,n=arguments,o=k&&k[a]||j[a];return o?(e=e&&c.tmpl.tmpls[e-1],h=h||e||b,f.tmpl=""+h===h?l&&l[h]||i[h]||i(h):h,f.isTag=A,f.converter=d,f.view=c,f.renderContent=m,c.ctx&&w(f.ctx,c.ctx),(g=o.apply(f,n.length>5?O.call(n,5):[]))||(g==b?"":g.toString())):""}function g(a,c,e,f,g,h){var i=e.views,j={tmpl:g,path:c,parent:e,data:f,ctx:a,views:t.isArray(f)?[]:{},hlp:d};return t.isArray(i)?i.splice(j.index=h!==b?h:i.length,0,j):i[j.index="_"+I++]=j,j}function h(a,c,d,e,f){var g,h;if(d&&"object"==typeof d&&!d.nodeType){for(g in d)c(g,d[g]);return a}return d&&e!==b?""+d===d&&(null===e?delete c[d]:(e=f?f(d,e):e)&&(c[d]=e)):f&&(e=f(b,e||d)),(h=y.onStoreItem)&&h(c,d,e,f),e}function i(a,b){return h(this,i,a,b,q)}function j(a,b){return h(this,j,a,b)}function k(a,b){return h(this,k,a,b)}function l(a,b){return h(this,l,a,b)}function m(a,c,d,e,f){var h,j,k,l,m,n,o,p,q,r,s={},u=f===A,v=this,x="";if(v.isTag?(q=v.tmpl,c=c||v.ctx,d=d||v.view,e=e||v.path,f=f||v.index,s=v.props):q=v.jquery&&v[0]||v,d=d||Q.topView,p=d.ctx,r=q.layout,a===d&&(a=d.data,r=A),c=c&&c===p?p:p?(p=w({},p),c?w(p,c):p):c||{},s.link===z&&(c.link=z),q.fn||(q=i[q]||i(q)),m=c.link&&y.onRenderItem,n=c.link&&y.onRenderItems,q){if(t.isArray(a)&&!r)for(l=u?d:f!==b&&d||g(c,e,d,a,q,f),h=0,j=a.length;h<j;h++)k=a[h],o=q.fn(k,g(c,e,l,k,q,(f||0)+h),Q),x+=m?m(o,s):o;else l=u?d:g(c,e,d,a,q,f),x+=a||r?q.fn(a,l,Q):"";return d.topKey=l.index,n?n(x,e,l.index,q,s):x}return""}function n(){throw"Syntax error"}function o(a,b,c){function d(b){(b-=D)&&J.push(a.substr(D,b).replace(E,"\\n"))}function e(b,e,g,h,i,j,k,l,m,n){i&&(h=":",g="html");var o="",q="",r=!l&&!h;if(e=e||h,d(n),D=n+b.length,j?y&&J.push(["*",k.replace(F,"$1")]):e?("else"===e&&(K[5]=a.substring(K[5],n),K=I.pop(),J=K[3],r=A),k=k?p(k,c).replace(H,function(a,b,c){return b?q+=c+",":o+=c+",",""}):"",o=o.slice(0,-1),k=k.slice(0,-1),f=[e,g||"",k,r&&[],"{"+(o?"props:{"+o+"},":"")+"path:'"+k+"'"+(q?",ctx:{"+q.slice(0,-1)+"}":"")+"}"],r&&(I.push(K),K=f,K[5]=D),J.push(f)):m&&(K[5]=a.substring(K[5],n),K=I.pop()),!K)throw"Expected block tag";J=K[3]}var f,g,h,i,j,k,l,m,n,q,s,t,v,w,x,y,z=b?{allowCode:y=b.allowCode,debug:b.debug}:{},B=b&&b.tmpls,C=[],D=0,I=[],J=C,K=[,,,C],L=0;for(a=a.replace(G,"\\$1"),a.replace(u,e),d(a.length),i=C.length,j=i?"":'"";',h=0;h<i;h++)g=C[h],"*"===g[0]?j=j.slice(0,h?-1:-3)+";"+g[1]+(h+1<i?"ret+=":""):""+g===g?j+='"'+g+'"+':(s=g[0],t=g[1],v=g[2],J=g[3],w=g[4],a=g[5],J&&(x=r(a,z,b,L++),o(a,x),B.push(x)),q=q||w.indexOf("view")>-1,j+=(":"===s?"html"===t?(l=A,"e("+v):t?(n=A,'c("'+t+'",view,'+v):(m=A,"((v="+v+')!=u?v:""'):(k=A,'t("'+s+'",view,"'+(t||"")+'",'+(J?B.length:'""')+","+w+(v?",":"")+v))+")+");return j=new Function("data, view, j, b, u",M+(m?"v,":"")+(k?"t=j.tag,":"")+(n?"c=j.convert,":"")+(l?"e=j.converters.html,":"")+"ret; try{\n\n"+(z.debug?"debugger;":"")+(y?"ret=":"return ")+j.slice(0,-1)+";\n\n"+(y?"return ret;":"")+"}catch(e){return j.err(e);}"),b&&(b.fn=j,b.useVw=n||q||k),j}function p(a,b){function c(a,c,i,j,k,l,m,o,p,q,r,s,t,u,v,w){function x(a,c,d,e,f,g,h){if(c){var i=(d?'view.hlp("'+d+'")':e?"view":"data")+(h?(f?"."+f:d?"":e?"":"."+c)+(g||""):(h=d?"":e?f||"":c,""));return b&&"("!==p&&(i="b("+i+',"'+h+'")'),i+(h?"."+h:"")}return a}if(k=k||"",i=i||c||r,j=j||o,p=p||v||"",k=k||"",!l)return h?(h=!s,h?a:'"'):g?(g=!t,g?a:'"'):(i?(f++,i):"")+(w?f?"":d?(d=z,"\b"):",":m?(f&&n(),d=A,"\b"+j+":"):j?j.replace(C,x)+(p?(e[++f]=A,p):k):k?a:u?(e[f--]=z,u+(p?(e[++f]=A,p):"")):q?(e[f]||n(),","):c?"":(h=s,g=t,'"'));n()}var d,e={},f=0,g=z,h=z;return a=(a+" ").replace(D,c)}function q(a,c,d,e){function f(b){if(""+b===b||b.nodeType>0)return h=b.nodeType>0?b:!v.test(b)&&B&&B(b)[0],h&&h.type&&((b=i[h.getAttribute(L)])||(a=a||"_"+J++,h.setAttribute(L,a),b=q(a,h.innerHTML,d,e),i[a]=b)),b}var g,h,j,k,l;if(g=f(c),e=e||(c.markup?c:{}),e.name=a,k=e.templates,!g&&c.markup&&(g=f(c.markup))&&(!g.fn||g.debug===c.debug&&g.allowCode===c.allowCode||(g=g.markup)),g!==b){a&&!d&&(P[a]=function(){return c.render.apply(c,arguments)}),g.fn||c.fn?g.fn&&(c=a&&a!==g.name?w(w({},g),e):g):(c=r(g,e,d,0),o(g,c));for(j in k)l=k[j],l.name!==j&&(k[j]=q(j,l,c));return c}}function r(a,b,c,d){function e(a){c[a]&&(f[a]=w(w({},c[a]),b[a]))}b=b||{};var f={markup:a,tmpls:[],links:[],render:m};return c&&(c.templates&&(f.templates=w(w({},c.templates),b.templates)),f.parent=c,f.name=c.name+"["+d+"]",f.index=d),w(f,b),c&&(e("templates"),e("tags"),e("helpers"),e("converters")),f}function s(a){return K[a]||(K[a]="&#"+a.charCodeAt(0)+";")}var t,u,v,w,x="v1.0pre",y={},z=!1,A=!0,B=a.jQuery,C=/^(?:null|true|false|\d[\d.]*|([\w$]+|~([\w$]+)|#(view|([\w$]+))?)([\w$.]*?)(?:[.[]([\w$]+)\]?)?|(['"]).*\8)$/g,D=/(\()(?=|\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*([)\]])([([]?))|(\s+)/g,E=/\r?\n/g,F=/\\(['"])/g,G=/\\?(['"])/g,H=/\x08(~)?([^\x08]+)\x08/g,I=0,J=0,K={"&":"&amp;","<":"&lt;",">":"&gt;"},L="data-jsv-tmpl",M="var j=j||"+(B?"jQuery.":"js")+"views,",N=/[\x00"&'<>]/g,O=Array.prototype.slice,P={},Q={jsviews:x,sub:y,debugMode:A,err:function(a){return Q.debugMode?"<br/><b>Error:</b> <em> "+(a.message||a)+". </em>":'""'},tmplFn:o,render:P,templates:i,tags:j,helpers:k,converters:l,View:g,convert:e,delimiters:c,tag:f};B?(t=B,t.templates=i,t.render=P,t.views=Q,t.fn.render=m):(t=a.jsviews=Q,t.extend=function(a,b){var c;a=a||{};for(c in b)a[c]=b[c];return a},t.isArray=Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}),w=t.extend,Q.topView={views:{},tmpl:{},hlp:d,ctx:Q.helpers},j({if:function(){var a=this,c=a.view;return c.onElse=function(a,d){for(var e=0,f=d.length;f&&!d[e++];)if(e===f)return"";return c.onElse=b,a.path="",a.renderContent(c)},c.onElse(this,arguments)},else:function(){var a=this.view;return a.onElse?a.onElse(this,arguments):""},for:function(){var a,b=this,c="",d=arguments,e=d.length;for(b.props.layout&&(b.tmpl.layout=A),a=0;a<e;a++)c+=b.renderContent(d[a]);return c},"=":function(a){return a},"*":function(a){return a}}),l({html:function(a){return a!=b?String(a).replace(N,s):""}}),c("{{","}}")}(this),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||n<f)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120==0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),function(a){"function"==typeof define&&define.amd?define(["jquery","./version"],a):a(jQuery)}(function(a){var b=0,c=Array.prototype.slice;return a.cleanData=function(b){return function(c){var d,e,f;for(f=0;null!=(e=c[f]);f++)try{d=a._data(e,"events"),d&&d.remove&&a(e).triggerHandler("remove")}catch(g){}b(c)}}(a.cleanData),a.widget=function(b,c,d){var e,f,g,h={},i=b.split(".")[0];b=b.split(".")[1];var j=i+"-"+b;return d||(d=c,c=a.Widget),a.isArray(d)&&(d=a.extend.apply(null,[{}].concat(d))),a.expr[":"][j.toLowerCase()]=function(b){return!!a.data(b,j)},a[i]=a[i]||{},e=a[i][b],f=a[i][b]=function(a,b){if(!this._createWidget)return new f(a,b);arguments.length&&this._createWidget(a,b)},a.extend(f,e,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),g=new c,g.options=a.widget.extend({},g.options),a.each(d,function(b,d){if(!a.isFunction(d))return void(h[b]=d);h[b]=function(){function a(){return c.prototype[b].apply(this,arguments)}function e(a){return c.prototype[b].apply(this,a)}return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()}),f.prototype=a.widget.extend(g,{widgetEventPrefix:e?g.widgetEventPrefix||b:b},h,{constructor:f,namespace:i,widgetName:b,widgetFullName:j}),e?(a.each(e._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,f,c._proto)}),delete e._childConstructors):c._childConstructors.push(f),a.widget.bridge(b,f),f},a.widget.extend=function(b){for(var d,e,f=c.call(arguments,1),g=0,h=f.length;g<h;g++)for(d in f[g])e=f[g][d],f[g].hasOwnProperty(d)&&void 0!==e&&(a.isPlainObject(e)?b[d]=a.isPlainObject(b[d])?a.widget.extend({},b[d],e):a.widget.extend({},e):b[d]=e);return b},a.widget.bridge=function(b,d){var e=d.prototype.widgetFullName||b;a.fn[b]=function(f){var g="string"==typeof f,h=c.call(arguments,1),i=this;return g?this.length||"instance"!==f?this.each(function(){var c,d=a.data(this,e);return"instance"===f?(i=d,!1):d?a.isFunction(d[f])&&"_"!==f.charAt(0)?(c=d[f].apply(d,h),c!==d&&void 0!==c?(i=c&&c.jquery?i.pushStack(c.get()):c,!1):void 0):a.error("no such method '"+f+"' for "+b+" widget instance"):a.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+f+"'")}):i=void 0:(h.length&&(f=a.widget.extend.apply(null,[f].concat(h))),this.each(function(){var b=a.data(this,e);b?(b.option(f||{}),b._init&&b._init()):a.data(this,e,new d(f,this))})),i}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(c,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=b++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=a(),this.hoverable=a(),this.focusable=a(),this.classesElementLookup={},d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this.options=a.widget.extend({},this.options,this._getCreateOptions(),c),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){var b=this;this._destroy(),a.each(this.classesElementLookup,function(a,c){b._removeClass(c,a)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:a.noop,widget:function(){return this.element},option:function(b,c){var d,e,f,g=b;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof b)if(g={},d=b.split("."),b=d.shift(),d.length){for(e=g[b]=a.widget.extend({},this.options[b]),f=0;f<d.length-1;f++)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b=d.pop(),1===arguments.length)return void 0===e[b]?null:e[b];e[b]=c}else{if(1===arguments.length)return void 0===this.options[b]?null:this.options[b];g[b]=c}return this._setOptions(g),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return"classes"===a&&this._setOptionClasses(b),this.options[a]=b,"disabled"===a&&this._setOptionDisabled(b),this},_setOptionClasses:function(b){var c,d,e;for(c in b)e=this.classesElementLookup[c],b[c]!==this.options.classes[c]&&e&&e.length&&(d=a(e.get()),this._removeClass(e,c),d.addClass(this._classes({element:d,keys:c,classes:b,add:!0})))},_setOptionDisabled:function(a){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!a),a&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(b){function c(c,f){var g,h;for(h=0;h<c.length;h++)g=e.classesElementLookup[c[h]]||a(),g=a(b.add?a.unique(g.get().concat(b.element.get())):g.not(b.element).get()),e.classesElementLookup[c[h]]=g,d.push(c[h]),f&&b.classes[c[h]]&&d.push(b.classes[c[h]])}var d=[],e=this;return b=a.extend({element:this.element,classes:this.options.classes||{}},b),this._on(b.element,{remove:"_untrackClassesElement"}),b.keys&&c(b.keys.match(/\S+/g)||[],!0),b.extra&&c(b.extra.match(/\S+/g)||[]),d.join(" ")},_untrackClassesElement:function(b){var c=this;a.each(c.classesElementLookup,function(d,e){-1!==a.inArray(b.target,e)&&(c.classesElementLookup[d]=a(e.not(b.target).get()))})},_removeClass:function(a,b,c){return this._toggleClass(a,b,c,!1)},_addClass:function(a,b,c){return this._toggleClass(a,b,c,!0)},_toggleClass:function(a,b,c,d){d="boolean"==typeof d?d:c;var e="string"==typeof a||null===a,f={extra:e?b:c,keys:e?a:b,element:e?this.element:a,add:d};return f.element.toggleClass(this._classes(f),d),this},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){if(b||!0!==f.options.disabled&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof g?f[g]:g).apply(f,arguments)}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^([\w:-]*)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.on(j,k,h):c.on(j,h)})},_off:function(b,c){c=(c||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,b.off(c).off(c),this.bindings=a(this.bindings.not(b).get()),this.focusable=a(this.focusable.not(b).get()),this.hoverable=a(this.hoverable.not(b).get())},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){this._addClass(a(b.currentTarget),null,"ui-state-hover")},mouseleave:function(b){this._removeClass(a(b.currentTarget),null,"ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){this._addClass(a(b.currentTarget),null,"ui-state-focus")},focusout:function(b){this._removeClass(a(b.currentTarget),null,"ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&!1===g.apply(this.element[0],[c].concat(d))||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?!0===e||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}}),a.widget}),function(a,b,c){b.toStaticHTML=b.toStaticHTML||function(a){return a};var d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;a.geo={_allCoordinates:function(b){for(var c=this._flatten(b),d=0,e=[];d<c.length;d++){var f,g,h,i=c[d].coordinates,j=i&&a.isArray(i[0]),k=j&&a.isArray(i[0][0]),l=k&&a.isArray(i[0][0][0]);for(l||(k||(j||(i=[i]),i=[i]),i=[i]),f=0;f<i.length;f++)for(g=0;g<i[f].length;g++)for(h=0;h<i[f][g].length;h++)e.push(i[f][g][h])}return e},_isGeodetic:function(b){for(;a.isArray(b);){if(b.length>1&&!a.isArray(b[0]))return b[0]>=-180.001&&b[0]<=180.001&&b[1]>=-90.001&&b[1]<=90.001;b=b[0]}return!1},center:function(b,c){var d=!1;!c&&a.geo.proj&&this._isGeodetic(b)&&(d=!0,b=a.geo.proj.fromGeodetic(b));var e=[(b[0]+b[2])/2,(b[1]+b[3])/2];return d?a.geo.proj.toGeodetic(e):e},expandBy:function(b,c,d,e){var f=!1;return!e&&a.geo.proj&&this._isGeodetic(b)&&(f=!0,b=a.geo.proj.fromGeodetic(b)),b=[b[0]-c,b[1]-d,b[2]+c,b[3]+d],f?a.geo.proj.toGeodetic(b):b},height:function(b,c){return!c&&a.geo.proj&&this._isGeodetic(b)&&(b=a.geo.proj.fromGeodetic(b)),b[3]-b[1]},_in:function(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&a[2]>=b[2]&&a[3]>=b[3]},_bboxDisjoint:function(a,b){return b[0]>a[2]||b[2]<a[0]||b[1]>a[3]||b[3]<a[1]},include:function(b,c,f){if(!c||!a.isArray(c))return b;var g=!1;return!f&&a.geo.proj&&this._isGeodetic(b||c)&&(g=!0),b?g&&(b=a.geo.proj.fromGeodetic(b)):b=[d,d,e,e],2===c.length&&(c=[c[0],c[1],c[0],c[1]]),a.geo.proj&&(c=a.geo.proj.fromGeodetic(c)),b[0]=Math.min(c[0],b[0]),b[1]=Math.min(c[1],b[1]),b[2]=Math.max(c[2],b[2]),b[3]=Math.max(c[3],b[3]),g?a.geo.proj.toGeodetic(b):b},polygonize:function(b,c){var d=!1;!c&&a.geo.proj&&this._isGeodetic(b)&&(d=!0,b=a.geo.proj.fromGeodetic(b));var e={type:"Polygon",coordinates:[[[b[0],b[1]],[b[0],b[3]],[b[2],b[3]],[b[2],b[1]],[b[0],b[1]]]]};return d&&(e.coordinates=a.geo.proj.toGeodetic(e.coordinates)),e},reaspect:function(b,c,d){var e=!1;!d&&a.geo.proj&&this._isGeodetic(b)&&(e=!0,b=a.geo.proj.fromGeodetic(b));var f,g,h=this.width(b,!0),i=this.height(b,!0),j=this.center(b,!0);return 0!==h&&0!==i&&c>0&&(h/i>c?(f=h/2,g=f/c):(g=i/2,f=g*c),b=[j[0]-f,j[1]-g,j[0]+f,j[1]+g]),e?a.geo.proj.toGeodetic(b):b},recenter:function(b,c,d){var e=!1;!d&&a.geo.proj&&(this._isGeodetic(b)&&(e=!0,b=a.geo.proj.fromGeodetic(b)),this._isGeodetic(c)&&(c=a.geo.proj.fromGeodetic(c)));var f=(b[2]-b[0])/2,g=(b[3]-b[1])/2;return b=[c[0]-f,c[1]-g,c[0]+f,c[1]+g],e?a.geo.proj.toGeodetic(b):b},scaleBy:function(b,c,d){var e=!1;!d&&a.geo.proj&&this._isGeodetic(b)&&(e=!0,b=a.geo.proj.fromGeodetic(b));var f=this.center(b,!0),g=(b[2]-b[0])*c/2,h=(b[3]-b[1])*c/2;return b=[f[0]-g,f[1]-h,f[0]+g,f[1]+h],e?a.geo.proj.toGeodetic(b):b},width:function(b,c){return!c&&a.geo.proj&&this._isGeodetic(b)&&(b=a.geo.proj.fromGeodetic(b)),b[2]-b[0]},bbox:function(b,f){var g,h=!1;if(!b)return c;if(b.bbox)g=!f&&a.geo.proj&&this._isGeodetic(b.bbox)?a.geo.proj.fromGeodetic(b.bbox):b.bbox;else{g=[d,d,e,e];var i=this._allCoordinates(b),j=0;if(0===i.length)return c;for(!f&&a.geo.proj&&this._isGeodetic(i)&&(h=!0,i=a.geo.proj.fromGeodetic(i));j<i.length;j++)g[0]=Math.min(i[j][0],g[0]),g[1]=Math.min(i[j][1],g[1]),g[2]=Math.max(i[j][0],g[2]),g[3]=Math.max(i[j][1],g[3])}return h?a.geo.proj.toGeodetic(g):g},centroid:function(b,f){var g;switch(b.type){case"Point":return a.extend({},b);case"LineString":case"Polygon":var h,i,j=0,k=a.merge([],"Polygon"===b.type?b.coordinates[0]:b.coordinates),l=1,m=[d,d,e,e];g=[0,0];var n=!1;for(!f&&a.geo.proj&&this._isGeodetic(k)&&(n=!0,k=a.geo.proj.fromGeodetic(k));l<=k.length;l++)h=l%k.length,m[0]=Math.min(k[h][0],m[0]),m[1]=Math.min(k[h][1],m[1]),m[2]=Math.max(k[h][0],m[2]),m[3]=Math.max(k[h][1],m[3]),i=k[l-1][0]*k[h][1]-k[h][0]*k[l-1][1],j+=i,g[0]+=(k[l-1][0]+k[h][0])*i,g[1]+=(k[l-1][1]+k[h][1])*i;return 0===j?k.length>0?(g[0]=Math.min(Math.max(k[0][0],m[0]),m[2]),g[1]=Math.min(Math.max(k[0][1],m[1]),m[3]),{type:"Point",coordinates:n?a.geo.proj.toGeodetic(g):g}):c:(j*=3,g[0]=Math.min(Math.max(g[0]/j,m[0]),m[2]),g[1]=Math.min(Math.max(g[1]/j,m[1]),m[3]),{type:"Point",coordinates:n?a.geo.proj.toGeodetic(g):g});case"MultiPoint":if(b.coordinates.length>0)return g=b.coordinates[0],{type:"Point",coordinates:[g[0],g[1]]};break;case"MultiLineString":case"MultiPolygon":if(b.coordinates.length>0)return this.centroid({type:b.type.substr(5),coordinates:b.coordinates[0]},f)}return c},contains:function(a,b){if("Polygon"!==a.type)return!1;switch(b.type){case"Point":return this._containsPolygonPoint(a.coordinates,b.coordinates);case"LineString":return this._containsPolygonLineString(a.coordinates,b.coordinates);case"Polygon":return this._containsPolygonLineString(a.coordinates,b.coordinates[0]);default:return!1}},_containsPolygonPoint:function(a,b){if(0===a.length||a[0].length<4)return!1;for(var c,d=0,e=a[0][0],f=1;f<a[0].length;f++)c=a[0][f],(e[1]<=b[1]&&b[1]<c[1]||c[1]<=b[1]&&b[1]<e[1]&&(b[0]<e[0]||b[0]<c[0]))&&e[0]+(c[0]-e[0])*(b[1]-e[1])/(c[1]-e[1])>b[0]&&d++,e=c;return d%2==1},_containsPolygonLineString:function(a,b){for(var c=0;c<b.length;c++)if(!this._containsPolygonPoint(a,b[c]))return!1;return!0},distance:function(b,d,e){var f=!e&&a.geo.proj&&this._isGeodetic(b.coordinates)?a.geo.proj.fromGeodetic(b.coordinates):b.coordinates,g=!e&&a.geo.proj&&this._isGeodetic(d.coordinates)?a.geo.proj.fromGeodetic(d.coordinates):d.coordinates;switch(b.type){case"Point":switch(d.type){case"Point":return this._distancePointPoint(g,f);case"LineString":return this._distanceLineStringPoint(g,f);case"Polygon":return this._containsPolygonPoint(g,f)?0:this._distanceLineStringPoint(g[0],f);default:return c}break;case"LineString":switch(d.type){case"Point":return this._distanceLineStringPoint(f,g);case"LineString":return this._distanceLineStringLineString(f,g);case"Polygon":return this._containsPolygonLineString(g,f)?0:this._distanceLineStringLineString(g[0],f);default:return c}break;case"Polygon":switch(d.type){case"Point":return this._containsPolygonPoint(f,g)?0:this._distanceLineStringPoint(f[0],g);case"LineString":return this._containsPolygonLineString(f,g)?0:this._distanceLineStringLineString(f[0],g);case"Polygon":
return this._containsPolygonLineString(f,g[0])?0:this._distanceLineStringLineString(f[0],g[0]);default:return c}}},_distancePointPoint:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},_distanceLineStringPoint:function(a,b){var c=d;if(a.length>0){var e=a[0],f=b[0]-e[0],g=b[1]-e[1];if(1===a.length)return Math.sqrt(f*f+g*g);for(var h=1;h<a.length;h++){var i=a[h],j=i[0]-e[0],k=i[1]-e[1],l=b[0]-i[0],m=b[1]-i[1],n=this._distanceSegmentPoint(j,k,f,g,l,m);if(0===n)return 0;n<c&&(c=n),e=i,f=l,g=m}}return Math.sqrt(c)},_distanceSegmentPoint:function(a,b,c,d,e,f){var g=a*c+b*d;if(g<=0)return c*c+d*d;var h=a*a+b*b;return g>=h?e*e+f*f:c*c+d*d-g*g/h},_distanceLineStringLineString:function(a,b){for(var c=d,e=0;e<b.length;e++)c=Math.min(c,this._distanceLineStringPoint(a,b[e]));return c},buffer:function(a,b,c){return this._buffer(a,b,c)},_buffer:function(b,d,e){var f=!1,g=b.coordinates;if(!e&&a.geo.proj&&this._isGeodetic(b.coordinates)&&(f=!0,g=a.geo.proj.fromGeodetic(b.coordinates)),"Point"===b.type){for(var h,i=[],j=180,k=0;k<=j;k++)h=360*k/j*(Math.PI/180),i.push([g[0]+Math.cos(h)*d,g[1]+Math.sin(h)*d]);return{type:"Polygon",coordinates:[f?a.geo.proj.toGeodetic(i):i]}}return c},_basic:function(a){for(var b,c,d=[],e=0,f=this._flatten(a);e<f.length;e++)if("Multi"===f[e].type.substring(0,5))for(b=f[e].type.substring(5),c=0;c<f[e].coordinates.length;c++)d.push({type:b,coordinates:f[e].coordinates[c]});else d.push(f[e]);return d},_flatten:function(b){var c=[],d=0;switch(b.type){case"Feature":a.merge(c,this._flatten(b.geometry));break;case"FeatureCollection":for(;d<b.features.length;d++)a.merge(c,this._flatten(b.features[d].geometry));break;case"GeometryCollection":for(;d<b.geometries.length;d++)a.merge(c,this._flatten(b.geometries[d]));break;default:c[0]=b}return c},length:function(b,c){var d,e,f,g=0,h=1;switch(b.type){case"Point":return 0;case"LineString":d=b.coordinates;break;case"Polygon":d=b.coordinates[0]}if(d){for(!c&&a.geo.proj&&this._isGeodetic(d)&&(d=a.geo.proj.fromGeodetic(d));h<d.length;h++)e=d[h][0]-d[h-1][0],f=d[h][1]-d[h-1][1],g+=Math.sqrt(e*e+f*f);return g}},area:function(b,c){var d,e,f=0,g=1;switch(b.type){case"Point":case"LineString":return 0;case"Polygon":d=b.coordinates[0]}if(d){for(!c&&a.geo.proj&&this._isGeodetic(d)&&(d=a.geo.proj.fromGeodetic(d));g<=d.length;g++)e=g%d.length,f+=(d[g-1][0]-d[e][0])*(d[g-1][1]+d[e][1])/2;return Math.abs(f)}},pointAlong:function(b,c,d){var e,f,g,h,i,j,k,l,m=0,n=0,o=0,p=[],q=1,r=!1;switch(b.type){case"Point":return a.extend({},b);case"LineString":g=b.coordinates;break;case"Polygon":g=b.coordinates[0]}if(g){if(0===c)return{type:"Point",coordinates:[g[0][0],g[0][1]]};if(1===c)return q=g.length-1,{type:"Point",coordinates:[g[q][0],g[q][1]]};for(!d&&a.geo.proj&&this._isGeodetic(g)&&(r=!0,g=a.geo.proj.fromGeodetic(g));q<g.length;q++)h=g[q][0]-g[q-1][0],i=g[q][1]-g[q-1][1],f=Math.sqrt(h*h+i*i),p.push(f),m+=f;for(q=0;q<p.length&&o<c;q++)n=o,o+=p[q]/m;return e=c-n,k=g[q-1],l=g[q],j=[k[0]+e*(l[0]-k[0]),k[1]+e*(l[1]-k[1])],{type:"Point",coordinates:r?a.geo.proj.toGeodetic(j):j}}},WKT:function(){function b(a){return"POINT "+c(a.coordinates)}function c(a){return a&&a.length?"("+a.join(" ")+")":"EMPTY"}function d(a){return"LINESTRING "+e(a.coordinates)}function e(a){if(a&&a.length){for(var b=[],c=0;c<a.length;c++)b.push(a[c].join(" "));return"("+b+")"}return"EMPTY"}function f(a){return"POLYGON "+g(a.coordinates)}function g(a){if(a&&a.length){for(var b=[],c=0;c<a.length;c++)b.push(e(a[c]));return"("+b+")"}return"EMTPY"}function h(a){return"MULTIPOINT "+e(a.coordinates)}function i(a){return"MULTILINSTRING "+g(a.coordinates)}function j(a){return"MULTIPOLYGON "+k(a.coordinates)}function k(a){if(a&&a.length){for(var b=[],c=0;c<a.length;c++)b.push(g(a[c]));return"("+b+")"}return"EMPTY"}function l(a){return"GEOMETRYCOLLECTION "+m(a.geometries)}function m(a){if(a&&a.length){for(var b=[],c=0;c<a.length;c++)b.push(n(a[c]));return"("+a+")"}return"EMPTY"}function n(a){if(!a||!a.type)return"";switch(a.type){case"Point":return b(a);case"LineString":return d(a);case"Polygon":return f(a);case"MultiPoint":return h(a);case"MultiLineString":return i(a);case"MultiPolygon":return j(a);case"GeometryCollection":return l(a);default:return""}}function o(a){var b=a.match(/\(\s*([\d\.\-]+)\s+([\d\.\-]+)\s*\)/);return b&&b.length>2?{type:"Point",coordinates:[parseFloat(b[1]),parseFloat(b[2])]}:null}function p(a){var b,c,d=a.match(/\s*\((.*)\)/),e=[],f=0;if(d&&d.length>1){for(b=d[1].match(/[\d\.\-]+\s+[\d\.\-]+/g);f<b.length;f++)c=b[f].match(/\s*([\d\.\-]+)\s+([\d\.\-]+)\s*/),e[f]=[parseFloat(c[1]),parseFloat(c[2])];return{type:"LineString",coordinates:e}}return null}function q(a){var b,c,d=a.match(/\s*\(\s*\((.*)\)\s*\)/),e=[],f=0;if(d&&d.length>1){for(b=d[1].match(/[\d\.\-]+\s+[\d\.\-]+/g);f<b.length;f++)c=b[f].match(/\s*([\d\.\-]+)\s+([\d\.\-]+)\s*/),e[f]=[parseFloat(c[1]),parseFloat(c[2])];return{type:"Polygon",coordinates:[e]}}return null}function r(b){var c;return-1===b.indexOf("((")?c=p(b):(c=s(b),c.coordinates=a.geo._allCoordinates(c)),c.type="MultiPoint",c}function s(a){for(var b,c=a.substr(2,a.length-4),d=c.split(/\),\s*\(/),e=0,f={type:"MultiLineString",coordinates:[]};e<d.length;e++)(b=p("("+d[e]+")"))&&f.coordinates.push(b.coordinates);return f}function t(a){for(var b,c=a.substr(1,a.length-2),d=c.split(/\),\s*\(/),e=0,f={type:"MultiPolygon",coordinates:[]};e<d.length;e++)(b=q("("+d[e]+")"))&&f.coordinates.push(b.coordinates);return f}function u(a){var b,c,d=a.substr(1,a.length-2),e=d.match(/\),[a-zA-Z]/g),f={type:"GeometryCollection",geometries:[]},g=0,h=0;if(e&&e.length>0){for(;g<e.length;g++)c=d.indexOf(e[g],h)-h+1,b=v(d.substr(h,c)),b&&f.geometries.push(b),h+=c+1;return b=v(d.substr(h)),b&&f.geometries.push(b),f}return null}function v(b){b=a.trim(b);var c=b.indexOf("("),d=b.substr(c);switch(a.trim(b.substr(0,c)).toUpperCase()){case"POINT":return o(d);case"LINESTRING":return p(d);case"POLYGON":return q(d);case"MULTIPOINT":return r(d);case"MULTILINESTRING":return s(d);case"MULTIPOLYGON":return t(d);case"GEOMETRYCOLLECTION":return u(d);default:return null}}return{stringify:n,parse:v}}(),proj:function(){var b=.017453292519943295,c=57.29577951308232,d=6378137;return{fromGeodeticPos:function(a){return[d*a[0]*b,d*Math.log(Math.tan(.7853981633974483+a[1]*b/2))]},fromGeodetic:function(b){if(!a.geo._isGeodetic(b))return b;var c=a.isArray(b[0]),d=this.fromGeodeticPos;if(c||4!==b.length){var e,f,g,h=c&&a.isArray(b[0][0]),i=h&&a.isArray(b[0][0][0]),j=[];for(i||(h||(c||(b=[b]),b=[b]),b=[b]),e=0;e<b.length;e++)for(j[e]=[],f=0;f<b[e].length;f++)for(j[e][f]=[],g=0;g<b[e][f].length;g++)j[e][f][g]=d(b[e][f][g]);return i?j:h?j[0]:c?j[0][0]:j[0][0][0]}var k=d([b[0],b[1]]),l=d([b[2],b[3]]);return[k[0],k[1],l[0],l[1]]},toGeodeticPos:function(a){return[a[0]/d*c,(1.5707963267948966-2*Math.atan(1/Math.exp(a[1]/d)))*c]},toGeodetic:function(b){if(a.geo._isGeodetic(b))return b;var c=a.isArray(b[0]),d=this.toGeodeticPos;if(c||4!==b.length){var e,f,g,h=c&&a.isArray(b[0][0]),i=h&&a.isArray(b[0][0][0]),j=[];for(i||(h||(c||(b=[b]),b=[b]),b=[b]),e=0;e<b.length;e++)for(j[e]=[],f=0;f<b[e].length;f++)for(j[e][f]=[],g=0;g<b[e][f].length;g++)j[e][f][g]=d(b[e][f][g]);return i?j:h?j[0]:c?j[0][0]:j[0][0][0]}var k=d([b[0],b[1]]),l=d([b[2],b[3]]);return[k[0],k[1],l[0],l[1]]}}}(),_serviceTypes:{}}}(jQuery,this),function(a,b,c){var d=function(){var a=5,b=document.createElement("div"),c=b.all||[];do{b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><br><![endif]--\x3e"}while(c[0]);return a>6?a:!a}();a.widget("geo.geographics",{_$elem:c,_options:{},_trueCanvas:!0,_trueDoubleBuffer:!0,_width:0,_height:0,_$canvas:c,_context:c,_$canvasSceneFront:c,_$canvasSceneBack:c,_$canvasSceneStale:c,_$canvasSceneDrawn:c,_timeoutEnd:null,_requireFlip:!1,_blitcanvas:c,_blitcontext:c,_$labelsContainerFront:c,_$labelsContainerBack:c,_labelsHtml:"",options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"},doubleBuffer:!0},_create:function(){this._$elem=this.element,this._options=this.options,this._$elem.css({webkitTransform:"translateZ(0)",display:"inline-block",overflow:"hidden",textAlign:"left"}),"static"===this._$elem.css("position")&&this._$elem.css("position","relative"),this._$elem.addClass("geo-graphics"),this._width=this._$elem.width(),this._height=this._$elem.height(),this._width&&this._height||(this._width=parseInt(this._$elem.css("width"),10),this._height=parseInt(this._$elem.css("height"),10));var c="position:absolute;left:0;top:0;margin:0;padding:0;",e="width:"+this._width+"px;height:"+this._height+"px;",f='width="'+this._width+'" height="'+this._height+'"';this._blitcanvas=document.createElement("canvas"),this._blitcanvas.getContext?(this._$canvas=a(b.toStaticHTML("<canvas "+f+' style="-webkit-transform:translateZ(0);'+c+'"></canvas>')),this._blitcanvas.width=1,this._blitcanvas.height=1,this._trueDoubleBuffer=this._blitcanvas.toDataURL().length>6,this._options.doubleBuffer&&this._trueDoubleBuffer||this._$elem.append(this._$canvas),this._context=this._$canvas[0].getContext("2d"),this._blitcanvas.width=this._width,this._blitcanvas.height=this._height,this._blitcontext=this._blitcanvas.getContext("2d"),this._$canvasSceneFront=a(b.toStaticHTML('<img id="scene0" style="-webkit-transform:translateZ(0);'+c+e+'" />')).on("load",a.proxy(this._canvasImgLoad,this)),this._$canvasSceneBack=a(b.toStaticHTML('<img id="scene1" style="-webkit-transform:translateZ(0);'+c+e+'" />')).on("load",a.proxy(this._canvasImgLoad,this))):d<=8&&(this._trueCanvas=!1,this._$elem.append("<div "+f+' style="'+c+e+'"></div>'),this._$canvas=this._$elem.children(":last"),G_vmlCanvasManager.initElement(this._$canvas[0]),this._context=this._$canvas[0].getContext("2d"),this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})),this._$labelsContainerFront=a(b.toStaticHTML('<div class="geo-labels-container" style="-webkit-transform:translateZ(0);'+c+e+'"></div>')),this._$labelsContainerBack=a(b.toStaticHTML('<div class="geo-labels-container" style="-webkit-transform:translateZ(0);'+c+e+'"></div>'))},_setOption:function(b,c){"style"===b&&(c=a.extend({},this._options.style,c)),a.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments),this._$elem.html(""),this._$elem.removeClass("geo-graphics")},clear:function(){this._context.clearRect(0,0,this._width,this._height),this._labelsHtml="",this._end()},drawArc:function(a,b,c,d){if(d=this._getGraphicStyle(d),"hidden"!==d.visibility&&d.opacity>0&&d.widthValue>0&&d.heightValue>0){var e=Math.min(d.widthValue,d.heightValue)/2;b=b*Math.PI/180,c=c*Math.PI/180,this._context.save(),this._context.translate(a[0],a[1]),d.widthValue>d.heightValue?this._context.scale(d.widthValue/d.heightValue,1):this._context.scale(1,d.heightValue/d.widthValue),this._context.beginPath(),this._context.arc(0,0,e,b,c,!1),this._trueCanvas&&this._context.restore(),d.doFill&&(this._context.fillStyle=d.fill,this._context.globalAlpha=d.opacity*d.fillOpacity,this._context.fill()),d.doStroke&&(this._context.lineJoin="round",this._context.lineWidth=d.strokeWidthValue,this._context.strokeStyle=d.stroke,this._context.globalAlpha=d.opacity*d.strokeOpacity,this._context.stroke()),this._trueCanvas||this._context.restore()}this._end()},drawPoint:function(a,b){b=this._getGraphicStyle(b),b.widthValue===b.heightValue&&b.heightValue===b.borderRadiusValue?this.drawArc(a,0,360,b):"hidden"!==b.visibility&&b.opacity>0&&(b.borderRadiusValue=Math.min(Math.min(b.widthValue,b.heightValue)/2,b.borderRadiusValue),a[0]-=b.widthValue/2,a[1]-=b.heightValue/2,this._context.beginPath(),this._context.moveTo(a[0]+b.borderRadiusValue,a[1]),this._context.lineTo(a[0]+b.widthValue-b.borderRadiusValue,a[1]),this._context.quadraticCurveTo(a[0]+b.widthValue,a[1],a[0]+b.widthValue,a[1]+b.borderRadiusValue),this._context.lineTo(a[0]+b.widthValue,a[1]+b.heightValue-b.borderRadiusValue),this._context.quadraticCurveTo(a[0]+b.widthValue,a[1]+b.heightValue,a[0]+b.widthValue-b.borderRadiusValue,a[1]+b.heightValue),this._context.lineTo(a[0]+b.borderRadiusValue,a[1]+b.heightValue),this._context.quadraticCurveTo(a[0],a[1]+b.heightValue,a[0],a[1]+b.heightValue-b.borderRadiusValue),this._context.lineTo(a[0],a[1]+b.borderRadiusValue),this._context.quadraticCurveTo(a[0],a[1],a[0]+b.borderRadiusValue,a[1]),this._context.closePath(),b.doFill&&(this._context.fillStyle=b.fill,this._context.globalAlpha=b.opacity*b.fillOpacity,this._context.fill()),b.doStroke&&(this._context.lineJoin="round",this._context.lineWidth=b.strokeWidthValue,this._context.strokeStyle=b.stroke,this._context.globalAlpha=b.opacity*b.strokeOpacity,this._context.stroke()),this._end())},drawLineString:function(a,b){this._drawLines([a],!1,b)},drawPolygon:function(a,b){if(this._trueCanvas&&1!==a.length){if(!a||!a.length||a[0].length<3)return;b=this._getGraphicStyle(b),this._blitcontext.globalCompositeOperation="copy";var c,d,e;if("hidden"!==b.visibility&&b.opacity>0){if(this._blitcontext.clearRect(0,0,this._width,this._height),b.doFill&&a.length>1){for(this._blitcontext.globalCompositeOperation="source-out",this._blitcontext.globalAlpha=1,this._blitcontext.beginPath(),d=1;d<a.length;d++)for(this._blitcontext.moveTo(a[d][0][0],a[d][0][1]),e=0;e<a[d].length;e++)this._blitcontext.lineTo(a[d][e][0],a[d][e][1]);this._blitcontext.closePath(),this._blitcontext.fill()}for(this._blitcontext.beginPath(),this._blitcontext.moveTo(a[0][0][0],a[0][0][1]),c=[a[0][0][0]-b.strokeWidthValue,a[0][0][1]-b.strokeWidthValue,a[0][0][0]+b.strokeWidthValue,a[0][0][1]+b.strokeWidthValue],d=1;d<a[0].length-1;d++)this._blitcontext.lineTo(a[0][d][0],a[0][d][1]),c[0]=Math.min(a[0][d][0]-b.strokeWidthValue,c[0]),c[1]=Math.min(a[0][d][1]-b.strokeWidthValue,c[1]),c[2]=Math.max(a[0][d][0]+b.strokeWidthValue,c[2]),c[3]=Math.max(a[0][d][1]+b.strokeWidthValue,c[3]);if(this._blitcontext.closePath(),b.doFill&&(this._blitcontext.fillStyle=b.fill,this._blitcontext.globalAlpha=b.opacity*b.fillOpacity,this._blitcontext.fill()),this._blitcontext.globalCompositeOperation="source-over",b.doStroke&&(this._blitcontext.lineCap=this._blitcontext.lineJoin="round",this._blitcontext.lineWidth=b.strokeWidthValue,this._blitcontext.strokeStyle=b.stroke,this._blitcontext.globalAlpha=b.opacity*b.strokeOpacity,this._blitcontext.stroke(),a.length>1))for(d=1;d<a.length;d++){for(this._blitcontext.beginPath(),this._blitcontext.moveTo(a[d][0][0],a[d][0][1]),e=1;e<a[d].length;e++)this._blitcontext.lineTo(a[d][e][0],a[d][e][1]);this._blitcontext.closePath(),this._blitcontext.stroke()}c[0]=Math.min(Math.max(c[0],0),this._width),c[1]=Math.min(Math.max(c[1],0),this._height),c[2]=Math.min(Math.max(c[2],0),this._width),c[3]=Math.min(Math.max(c[3],0),this._height),c[0]!==c[2]&&c[1]!==c[3]&&(this._context.drawImage(this._blitcanvas,c[0],c[1],c[2]-c[0],c[3]-c[1],c[0],c[1],c[2]-c[0],c[3]-c[1]),this._end())}}else this._drawLines(a,!0,b)},drawBbox:function(a,b){this._drawLines([[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]],[a[0],a[1]]]],!0,b)},drawLabel:function(a,b){this._labelsHtml+='<div class="geo-label" style="-webkit-transform:translateZ(0);position:absolute; left:'+a[0]/this._width*100+"%; top:"+a[1]/this._height*100+'%;">'+b+"</div>"},resize:function(a,b){this._width=this._$elem.width(),this._height=this._$elem.height(),this._width&&this._height||(this._width=parseInt(this._$elem.css("width"),10),this._height=parseInt(this._$elem.css("height"),10)),this._trueCanvas?(this._$canvas[0].width=this._width,this._$canvas[0].height=this._height,this._$canvasSceneFront.css({left:a,top:b}),this._$canvasSceneBack.css({width:this._width,height:this._height})):this._$canvas.css({width:this._width,height:this._height});var c=this._$labelsContainerFront.position();this._$labelsContainerFront.css({left:c.left+a,top:c.top+b,width:this._width,height:this._height}),this._$labelsContainerBack.css({width:this._width,height:this._height})},interactiveTransform:function(a,b){this._timeoutEnd&&(clearTimeout(this._timeoutEnd),this._timeoutEnd=null),this._trueCanvas&&this._options.doubleBuffer&&this._trueDoubleBuffer?(this._canvasSceneLoad(),this._$canvasSceneFront.css({left:Math.round(a[0]),top:Math.round(a[1]),width:this._width*b,height:this._height*b})):this._context.clearRect(0,0,this._width,this._height),this._$labelsContainerFront.css({left:Math.round(a[0]),top:Math.round(a[1]),width:this._width*b,height:this._height*b})},_canvasImgLoad:function(){var a=this;a._$canvasSceneFront=a._$canvasSceneDrawn.prependTo(a._$elem),a._$canvasSceneBack=a._$canvasSceneStale,a._$canvasSceneBack.detach()},_canvasSceneLoad:function(){var a=this;a._requireFlip&&(a._requireFlip=!1,a._$canvasSceneStale=a._$canvasSceneFront,a._$canvasSceneDrawn=a._$canvasSceneBack.css({left:0,top:0,width:a._width,height:a._height}).prop("src",a._$canvas[0].toDataURL()))},_endCallback:function(){var a=this;if(a._timeoutEnd){a._trueCanvas&&a._options.doubleBuffer&&a._trueDoubleBuffer&&this._canvasSceneLoad(),a._$labelsContainerBack.html(b.toStaticHTML(a._labelsHtml)).find("a").css({position:"relative",zIndex:1,display:"inline-block",webkitTransform:"translateZ(0)"});var c=a._$labelsContainerFront;a._$labelsContainerFront=a._$labelsContainerBack.css({left:0,top:0,width:a._width,height:a._height}).appendTo(a._$elem),a._$labelsContainerBack=c.detach(),a._timeoutEnd=null}},_end:function(){this._timeoutEnd&&(clearTimeout(this._timeoutEnd),this._timeoutEnd=null),this._requireFlip=!0,this._timeoutEnd=setTimeout(a.proxy(this._endCallback,this),20)},_getGraphicStyle:function(b){function c(a){return a=parseInt(a,10),+a+""===a?+a:a}return b=a.extend({},this._options.style,b),b.borderRadiusValue=c(b.borderRadius),b.fill=b.fill||b.color,b.doFill=b.fill&&b.fillOpacity>0,b.stroke=b.stroke||b.color,b.strokeWidthValue=c(b.strokeWidth),b.doStroke=b.stroke&&b.strokeOpacity>0&&b.strokeWidthValue>0,b.widthValue=c(b.width),b.heightValue=c(b.height),b},_drawLines:function(a,b,c){if(a&&a.length&&!(a[0].length<2)){var d,e;if(c=this._getGraphicStyle(c),"hidden"!==c.visibility&&c.opacity>0){for(this._context.beginPath(),d=0;d<a.length;d++)for(this._context.moveTo(a[d][0][0],a[d][0][1]),e=1;e<a[d].length;e++)this._context.lineTo(a[d][e][0],a[d][e][1]);b&&this._context.closePath(),b&&c.doFill&&(this._context.fillStyle=c.fill,this._context.globalAlpha=c.opacity*c.fillOpacity,this._context.fill()),c.doStroke&&(this._context.lineCap=this._context.lineJoin="round",this._context.lineWidth=c.strokeWidthValue,this._context.strokeStyle=c.stroke,this._context.globalAlpha=c.opacity*c.strokeOpacity,this._context.stroke()),this._end()}}}})}(jQuery,window),function(a,b,c){var d=0,e=function(){var a=5,b=document.createElement("div"),c=b.all||[];do{b.innerHTML="\x3c!--[if gt IE "+ ++a+"]><br/><![endif]--\x3e"}while(c[0]);return a>6?a:!a}(),f=function(){return(navigator.userAgent.match(/gecko\/*\d/i)||[]).length>0}(),g={bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{static:"default",pan:"url(data:image/vnd.microsoft.icon;base64,AAACAAEAICACAAgACAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8=), move",click:"crosshair",zoom:"crosshair",dragBox:"crosshair",dragCircle:"crosshair",drawPoint:"crosshair",drawLineString:"crosshair",drawPolygon:"crosshair",measureLength:"crosshair",measureArea:"crosshair"},measureLabels:{length:"{{:length.toFixed( 2 )}} m",area:"{{:area.toFixed( 2 )}} sq m"},drawStyle:{},shapeStyle:{},mode:"pan",pannable:!0,scroll:"default",shift:"default",services:[{class:"osm",type:"tiled",src:function(a){return"//"+String.fromCharCode(97+a.index%3)+".tile.openstreetmap.org/"+a.zoom+"/"+a.tile.column+"/"+a.tile.row+".png"},attr:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors'}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-20037508.342787,20037508.342787]},axisLayout:"map",zoom:0,zoomMin:0,zoomMax:Number.POSITIVE_INFINITY,zoomFactor:2,pixelSize:0};a.widget("geo.geomap",{_$elem:c,_map:c,_created:!1,_createdGraphics:!1,_widgetId:0,_tmplLengthId:"",_tmplAreaId:"",_contentBounds:{},_$resizeContainer:c,_$eventTarget:c,_$contentFrame:c,_$existingChildren:c,_$attrList:c,_$servicesContainer:c,_$shapesContainers:c,_$panContainer:c,_$shapesContainer:c,_$drawContainer:c,_$measureContainer:c,_$measureLabel:c,_dpi:96,_currentServices:[],_center:c,_pixelSize:c,_centerMax:c,_pixelSizeMax:c,_pixelSizeMin:c,_userGeodetic:!0,_centerInteractive:c,_pixelSizeInteractive:c,_timeoutInteractive:null,_timeoutWheel:null,_triggerInteractive:!1,_timeoutRefreshShapes:null,_loadCount:0,_wheelLevel:0,_fullZoomFactor:2,_partialZoomFactor:1.18920711500273,_mouseDown:c,_inOp:c,_toolPan:c,_shiftDown:c,_anchor:c,_current:c,_downDate:c,_moveDate:c,_clickDate:c,_lastMove:c,_lastDrag:c,_windowHandler:null,_resizeTimeout:null,_panning:c,_velocity:c,_friction:c,_pointerEvents:c,_supportTouch:c,_softDblClick:c,_isTap:c,_isDbltap:c,_isMultiTouch:c,_multiTouchAnchor:[],_multiTouchAnchorBbox:c,_multiTouchCurrentBbox:c,_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:a.extend({},g),_createWidget:function(b,c){if(this._$elem=a(c),this._$elem.is(".geo-service"))return this._graphicShapes=[],void a.Widget.prototype._createWidget.apply(this,arguments);this._widgetId=d++,this._serviceIdSeed=0,this._tmplLengthId="geoMeasureLength"+this._widgetId,this._tmplAreaId="geoMeasureArea"+this._widgetId,this._$elem.addClass("geo-map").css({webkitTransform:"translateZ(0)",touchAction:"none"}),this._initOptions=b||{},this._forcePosition(this._$elem),this._$elem.css("text-align","left");var e=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left"),10),y:parseInt(this._$elem.css("padding-top"),10),width:e.width,height:e.height},this._createChildren(),this._center=[0,0],this._centerMax=[0,0],this._centerInteractive=[0,0],this.options.pixelSize=this._pixelSize=this._pixelSizeMax=156543.03392799935,this._pixelSizeMin=this._pixelSizeMax/Math.pow(2,17),this._mouseDown=this._inOp=this._toolPan=this._shiftDown=this._panning=this._isTap=this._isDbltap=this._isMultiTouch=!1,this._anchor=[0,0],this._current=[0,0],this._lastMove=[0,0],this._lastDrag=[0,0],this._velocity=[0,0],this._friction=[.8,.8],this._downDate=this._moveDate=this._clickDate=0,this._drawPixels=[],this._drawCoords=[],this._graphicShapes=[],a.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){if(this._options=this.options,this._$elem.is(".geo-service"))return this._map=this._$elem.data("geoMap"),void this._$elem.data("geoService",this);this._map=this,this._pointerEvents=b.PointerEvent,this._supportTouch="ontouchend"in document,this._softDblClick=this._pointerEvents||this._supportTouch||7===e;var d=this,g=this._pointerEvents?"pointerdown":this._supportTouch?"touchstart mousedown":"mousedown",h=this._pointerEvents?"pointerup pointercancel":this._supportTouch?"touchend touchcancel mouseup":"mouseup",i=this._pointerEvents?"pointermove":this._supportTouch?"touchmove mousemove":"mousemove";a(document).keydown(a.proxy(this._document_keydown,this)),this._softDblClick?this._$eventTarget.on("softdblclick",a.proxy(this._eventTarget_dblclick,this)):this._$eventTarget.dblclick(a.proxy(this._eventTarget_dblclick,this)),this._$eventTarget.bind(g,a.proxy(this._eventTarget_touchstart,this));var j=this._$eventTarget[0].setCapture||this._pointerEvents?this._$eventTarget:a(document);j.bind(i,a.proxy(this._dragTarget_touchmove,this)),j.bind(h,a.proxy(this._dragTarget_touchstop,this)),this._$eventTarget.mousewheel(a.proxy(this._eventTarget_mousewheel,this)),this._windowHandler=function(){d._resizeTimeout&&clearTimeout(d._resizeTimeout),d._resizeTimeout=setTimeout(function(){d._created&&d._$elem.geomap("resize",!0)},500)},a(b).resize(this._windowHandler),this._$drawContainer.geographics({style:this._initOptions.drawStyle||{},doubleBuffer:!1}),this._options.drawStyle=this._$drawContainer.geographics("option","style"),this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{},doubleBuffer:!f}),this._createdGraphics=!0,this._options.shapeStyle=this._$shapesContainer.geographics("option","style"),this._initOptions&&(this._initOptions.tilingScheme!==c&&this._setOption("tilingScheme",this._initOptions.tilingScheme||null,!1),this._initOptions.services&&(this._options.services=a.merge([],this._initOptions.services)),this._initOptions.bboxMax&&(this._setOption("bboxMax",this._initOptions.bboxMax,!1),this._setOption("bbox",this._initOptions.bboxMax,!1)),this._initOptions.zoomMin!==c&&this._setOption("zoomMin",this._initOptions.zoomMin,!1),this._initOptions.zoomMax!==c&&this._setOption("zoomMax",this._initOptions.zoomMax,!1),this._initOptions.zoomFactor!==c&&(this._setOption("zoomFactor",this._initOptions.zoomFactor,!1),this._fullZoomFactor=this._initOptions.zoomFactor,this._partialZoomFactor=Math.pow(4,1/this._fullZoomFactor)),this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,!1),this._initOptions.center&&this._setOption("center",this._initOptions.center,!1),this._initOptions.zoom!==c&&this._setOption("zoom",this._initOptions.zoom,!1)),a.templates(this._tmplLengthId,this._options.measureLabels.length),a.templates(this._tmplAreaId,this._options.measureLabels.area),this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._createServices(),this._refresh(),this._created=!0},_setOption:function(b,d,e){if("pixelSize"!==b){e=e===c||e,this._$elem.is(".geo-map")&&this._panFinalize();var f,g,h,i;switch(b){case"bbox":this._created&&this._clearInteractiveTimeout(),this._userGeodetic="map"===this._options.axisLayout&&a.geo.proj&&a.geo._isGeodetic(d),this._userGeodetic&&(d=a.geo.proj.fromGeodetic(d)),f=[d[0]+(d[2]-d[0])/2,d[1]+(d[3]-d[1])/2],g=Math.max(a.geo.width(d,!0)/this._contentBounds.width,a.geo.height(d,!0)/this._contentBounds.height),i=this._getZoom(f,g),this._options.tilingScheme?g=this._getPixelSize(Math.min(Math.max(i,this._options.zoomMin),this._options.zoomMax)):i<this._options.zoomMin?g=this._getPixelSize(this._options.zoomMin):i>this._options.zoomMax&&(g=this._getPixelSize(this._options.zoomMax)),this._created?(this._setInteractiveCenterAndSize(f,g),this._setInteractiveTimeout(!1)):this._setCenterAndSize(f,g,!1,e),d=this._getBbox(f,g);break;case"bboxMax":this._userGeodetic="map"===this._options.axisLayout&&a.geo.proj&&a.geo._isGeodetic(d);break;case"center":this._created&&this._clearInteractiveTimeout(),this._userGeodetic="map"===this._options.axisLayout&&a.geo.proj&&a.geo._isGeodetic(d),this._userGeodetic&&(d=a.geo.proj.fromGeodetic(d)),this._created?(this._setInteractiveCenterAndSize(d,this._pixelSizeInteractive),this._interactiveTransform(),this._setInteractiveTimeout(!1)):this._setCenterAndSize(d,this._pixelSize,!1,e);break;case"measureLabels":d=a.extend(this._options.measureLabels,d),a.templates(this._tmplLengthId,this._options.measureLabels.length),a.templates(this._tmplAreaId,this._options.measureLabels.area);break;case"drawStyle":this._$drawContainer&&(this._$drawContainer.geographics("option","style",d),d=this._$drawContainer.geographics("option","style"));break;case"shapeStyle":this._$elem.is(".geo-service")&&!this._createdGraphics&&this._createServiceGraphics(),this._createdGraphics&&(this._$shapesContainer.geographics("option","style",d),d=this._$shapesContainer.geographics("option","style"));break;case"mode":this._resetDrawing(),this._$eventTarget.css("cursor",this._options.cursors[d]);break;case"zoom":this._userGeodetic="map"===this._options.axisLayout&&a.geo.proj,this._created?this._setZoom(d,!1,e):(d=Math.max(d,0),this._setCenterAndSize(this._center,this._getPixelSize(d),!1,e))}switch(a.Widget.prototype._setOption.apply(this,arguments),b){case"bbox":case"center":this._userGeodetic&&(this._options.bbox=a.geo.proj.toGeodetic(this._options.bbox),this._options.center=a.geo.proj.toGeodetic(this._center));break;case"tilingScheme":null!==d&&(this._pixelSizeMax=this._getPixelSize(0),this._pixelSizeMin=this._getPixelSize(d.pixelSizes?d.pixelSizes.length-1:d.levels-1),this._centerMax=[d.origin[0]+this._pixelSizeMax*d.tileWidth/2,d.origin[1]+this._pixelSizeMax*d.tileHeight/2]);break;case"bboxMax":h=this._userGeodetic?a.geo.proj.fromGeodetic(d):d,this._centerMax=a.geo.center(h),this._pixelSizeMax=Math.max(a.geo.width(h,!0)/this._contentBounds.width,a.geo.height(h,!0)/this._contentBounds.height);break;case"services":this._createServices(),e&&(this._refresh(),this._refreshAllShapes());break;case"shapeStyle":e&&this._createdGraphics&&(this._$shapesContainer.geographics("clear"),this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes))}}},destroy:function(){if(this._$elem.is(".geo-service"))this._createdGraphics&&(this._$shapesContainer.geographics("destroy"),this._$shapesContainer=c,this._createdGraphics=!1);else{clearTimeout(this._timeoutInteractive),this._timeoutInteractive=null,this._created=!1,a(b).unbind("resize",this._windowHandler);for(var d=0;d<this._currentServices.length;d++)this._currentServices[d].serviceContainer.geomap("destroy"),a.geo._serviceTypes[this._currentServices[d].type].destroy(this,this._$servicesContainer,this._currentServices[d]);this._$shapesContainer.geographics("destroy"),this._$shapesContainer=c,this._createdGraphics=!1,this._$drawContainer.geographics("destroy"),this._$drawContainer=c,this._$existingChildren.detach(),this._$elem.html(""),this._$elem.append(this._$existingChildren),this._$elem.removeClass("geo-map")}a.Widget.prototype.destroy.apply(this,arguments)},toMap:function(b){return b=this._toMap(b),this._userGeodetic?a.geo.proj.toGeodetic(b):b},toPixel:function(b,c,d){return this._toPixel(a.geo.proj?a.geo.proj.fromGeodetic(b):b,c,d)},opacity:function(b,c){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("opacity",b,this._$elem);else if(b>=0||b<=1)for(var d=0;d<this._currentServices.length;d++){var e=this._currentServices[d];c&&e.serviceContainer[0]!==c[0]||(e.style.opacity=b,e.serviceObject.style=a.extend({},e.serviceObject.style,e.style),a.geo._serviceTypes[e.type].opacity(this,e))}},toggle:function(b,d){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("toggle",b,this._$elem);else for(var e=0;e<this._currentServices.length;e++){var f=this._currentServices[e];d&&f.serviceContainer[0]!==d[0]||(b===c&&(b="visible"!==f.style.visibility),f.style.visibility=b?"visible":"hidden",f.serviceObject.style=a.extend({},f.serviceObject.style,f.style),f.serviceContainer.toggle(b),b&&a.geo._serviceTypes[f.type].refresh(this,f))}},zoom:function(a){null!==a&&this._setZoom(this._options.zoom+a,!1,!0)},refresh:function(a,b){this._panning||(this._$elem.is(".geo-service")?this._$elem.closest(".geo-map").geomap("refresh",a,this._$elem):(this._refresh(a,b),this._refreshAllShapes(b)))},resize:function(b){var c,d=this._findMapSize(),e=d.width/2-this._contentBounds.width/2,f=d.height/2-this._contentBounds.height/2;for(this._contentBounds={x:parseInt(this._$elem.css("padding-left"),10),y:parseInt(this._$elem.css("padding-top"),10),width:d.width,height:d.height},this._$resizeContainer.css({width:d.width,height:d.height}),c=0;c<this._currentServices.length;c++)a.geo._serviceTypes[this._currentServices[c].type].resize(this,this._currentServices[c],e,f);for(this._$elem.find(".geo-graphics").css({width:d.width,height:d.height}).geographics("resize",e,f),c=0;c<this._drawPixels.length;c++)this._drawPixels[c][0]+=e,this._drawPixels[c][1]+=f
;this._setCenterAndSize(this._center,this._pixelSize,b,!0)},append:function(b){if(b&&(a.isPlainObject(b)||a.isArray(b)&&b.length>0)){this._createdGraphics||this._createServiceGraphics();var d,e,f,g,h,i;for(d=a.isArray(b)?b:"FeatureCollection"===b.type?b.features:[b],f=1;f<arguments.length;f++)null!==(e=arguments[f])&&("object"==typeof e?g=e:"number"==typeof e||"string"==typeof e?h=e:"boolean"==typeof e&&(i=e));for(f=0;f<d.length;f++){if(!a.data(d[f],"geoBbox")){var j=a.geo.bbox(d[f]);a.geo.proj&&a.geo._isGeodetic(j)&&(j=a.geo.proj.fromGeodetic(j)),a.data(d[f],"geoBbox",j)}this._graphicShapes.push({shape:d[f],style:g,label:h})}(i===c||i)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())}},empty:function(a){this._graphicShapes=[],(a===c||a)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())},find:function(b,c){if(this._timeoutInteractive)return[];var d,e,f,g,h=a.isPlainObject(b),i=this._map._pixelSize*c,j=[];for(this._$elem.is(".geo-map")&&a(this._$elem.find(".geo-service").get().reverse()).each(function(){j=a.merge(j,a(this).geomap("find",b,c))}),g=this._graphicShapes.length-1;g>=0;g--)if(d=this._graphicShapes[g],h)if("Point"===d.shape.type)a.geo.distance(d.shape,b)<=i&&j.push(d.shape);else{var k=a.data(d.shape,"geoBbox"),l={type:"Polygon",coordinates:[[[k[0],k[1]],[k[0],k[3]],[k[2],k[3]],[k[2],k[1]],[k[0],k[1]]]]},m={type:"Point",coordinates:a.geo.proj&&a.geo._isGeodetic(b.coordinates)?a.geo.proj.fromGeodetic(b.coordinates):b.coordinates};if(a.geo.distance(l,m,!0)<=i)for(e=a.geo._basic(d.shape),f=0;f<e.length;f++)if(a.geo.distance(e[f],b)<=i){j.push(d.shape);break}}else j.push(d.shape);return j},remove:function(b,d){if(b&&(a.isPlainObject(b)||a.isArray(b)&&b.length>0)){for(var e,f=a.isArray(b)?b:[b],g=0;g<this._graphicShapes.length;g++)a.inArray(this._graphicShapes[g].shape,f)>=0&&(e=this._graphicShapes.slice(g+1),this._graphicShapes.length=g,this._graphicShapes.push.apply(this._graphicShapes,e),g--);(d===c||d)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())}},_getBbox:function(a,b){a=a||this._center,b=b||this._pixelSize;var c=this._contentBounds.width/2*b,d=this._contentBounds.height/2*b;return[a[0]-c,a[1]-d,a[0]+c,a[1]+d]},_setBbox:function(b){var c=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2],d=Math.max(a.geo.width(b,!0)/this._contentBounds.width,a.geo.height(b,!0)/this._contentBounds.height),e=this._getZoom(c,d);this._options.tilingScheme?d=this._getPixelSize(Math.min(Math.max(e,this._options.zoomMin),this._options.zoomMax)):e<this._options.zoomMin?d=this._getPixelSize(this._options.zoomMin):e>this._options.zoomMax&&(d=this._getPixelSize(this._options.zoomMax)),this._setInteractiveCenterAndSize(c,d),this._interactiveTransform()},_getBboxMax:function(){var a=this._contentBounds.width/2*this._pixelSizeMax,b=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-a,this._centerMax[1]-b,this._centerMax[0]+a,this._centerMax[1]+b]},_getCenter:function(){return this._center},_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(b,c){b=b||this._center,c=c||this._pixelSize;var d=this._options.tilingScheme;if(d){if(d.pixelSizes){for(var e=Math.floor(1e3*c),f=d.pixelSizes.length,g=f-1;g>=0;g--)if(Math.floor(1e3*d.pixelSizes[g])>=e)return g;return 0}return Math.floor(Math.log(d.basePixelSize/c)/Math.log(2))}var h=this._contentBounds.width/this._contentBounds.height,i=a.geo.reaspect(this._getBbox(b,c),h,!0),j=a.geo.reaspect(this._getBboxMax(),h,!0);return Math.round(Math.log(a.geo.width(j,!0)/a.geo.width(i,!0))/Math.log(this._fullZoomFactor))},_setZoom:function(a,b){this._clearInteractiveTimeout(),a=Math.min(Math.max(a,this._options.zoomMin),this._options.zoomMax),this._setInteractiveCenterAndSize(this._centerInteractive,this._getPixelSize(a)),this._interactiveTransform(),this._setInteractiveTimeout(b)},_createChildren:function(){this._$existingChildren=this._$elem.children(),this._forcePosition(this._$existingChildren),this._$existingChildren.detach().css({mozUserSelect:"none"});var c="width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0;",d="position:absolute; left:0; top:0;";this._$elem.prepend(b.toStaticHTML('<div class="geo-event-target geo-content-frame" style="position:absolute; left:'+this._contentBounds.x+"px; top:"+this._contentBounds.y+"px;"+c+'overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>')),this._$eventTarget=this._$contentFrame=this._$elem.children(":first"),this._$contentFrame.append('<div class="geo-services-container" style="'+d+c+'"></div>'),this._$servicesContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<ul style="position: absolute; bottom: 8px; left: 8px; list-style-type: none; max-width: 50%; padding: 0; margin: 0;"></ul>'),this._$attrList=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-draw-container" style="'+d+c+'"></div>'),this._$drawContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-measure-container" style="'+d+c+'"><span class="geo-measure-label" style="'+d+'; display: none;"></span></div>'),this._$measureContainer=this._$contentFrame.children(":last"),this._$measureLabel=this._$measureContainer.children(),this._$contentFrame.append('<div class="geo-shapes-container" style="'+d+c+'"></div>'),this._$shapesContainer=this._$contentFrame.children(":last"),this._$panContainer=a([this._$shapesContainer[0],this._$drawContainer[0],this._$measureContainer[0]]),this._$resizeContainer=a([this._$contentFrame[0],this._$servicesContainer[0],this._$eventTarget[0],this._$measureContainer[0]]),this._$contentFrame.append(this._$existingChildren),a("#geo-measure-style").length||a("head").prepend(b.toStaticHTML('<style type="text/css" id="geo-measure-style">.geo-measure-label { margin: 4px 0 0 6px; font-family: sans-serif;'+(e?"letter-spacing: 2px; color: #444; filter:progid:DXImageTransform.Microsoft.DropShadow(Color=white, OffX=1, OffY=2, Positive=true);":"color: #000; text-shadow: #fff 1px 2px; font-weight: bold;")+" }</style>"))},_createServices:function(){var c,d;for(d=0;d<this._currentServices.length;d++)this._currentServices[d].serviceContainer.geomap("destroy"),a.geo._serviceTypes[this._currentServices[d].type].destroy(this,this._$servicesContainer,this._currentServices[d]);for(this._currentServices=[],this._$servicesContainer.html(""),this._$attrList.html(""),d=0;d<this._options.services.length;d++){c=this._currentServices[d]=a.extend({},this._options.services[d]),c.serviceObject=this._options.services[d],c.style=a.extend({visibility:"visible",opacity:1},c.style);var e,f=c.id?' id="'+c.id+'"':"",g='class="geo-service '+(c.class?c.class:"")+'"',h="<div "+f+g+' style="-webkit-transform:translateZ(0);position:absolute; left:0; top:0; width:32px; height:32px; margin:0; padding:0; display:'+("visible"===c.style.visibility?"block":"none")+';"></div>';this._$servicesContainer.append(b.toStaticHTML(h)),e=this._$servicesContainer.children(":last"),c.serviceContainer=e,a.geo._serviceTypes[c.type].create(this,e,c,d),e.data("geoMap",this).geomap(),c.attr&&this._$attrList.append("<li>"+c.attr+"</li>")}this._$shapesContainers=this._$shapesContainer,this._$attrList.find("a").css({position:"relative",zIndex:1,display:"inline-block",webkitTransform:"translateZ(0)"})},_createServiceGraphics:function(){var a=this._$elem.closest(".geo-content-frame");this._$elem.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0; width:'+a.css("width")+"; height:"+a.css("height")+'; margin:0; padding:0;"></div>'),this._$shapesContainer=this._$elem.children(":last"),this._map._$shapesContainers=this._map._$shapesContainers.add(this._$shapesContainer),this._$shapesContainer.geographics({doubleBuffer:!f}),this._createdGraphics=!0,this._options.shapeStyle=this._$shapesContainer.geographics("option","style")},_refreshDrawing:function(){if(this._$drawContainer.geographics("clear"),this._drawPixels.length>0){var b,c,d,e,f,g=this._options.mode,h=this._drawPixels,i=this._drawCoords;switch(g){case"measureLength":g="drawLineString",c={type:"LineString",coordinates:i},b=a.render[this._tmplLengthId]({length:a.geo.length(c,!0)}),d=a.merge([],h[h.length-1]);break;case"measureArea":g="drawPolygon",c={type:"Polygon",coordinates:[a.merge([],i)]},c.coordinates[0].push(i[0]),b=a.render[this._tmplAreaId]({area:a.geo.area(c,!0)}),d=this._toPixel(a.geo.centroid(c).coordinates),h=[h];break;case"drawPolygon":h=[h]}this._$drawContainer.geographics(g,h),b&&(this._$measureLabel.html(b),e=this._contentBounds.width-(this._$measureLabel.outerWidth(!0)+d[0]),f=this._contentBounds.height-(this._$measureLabel.outerHeight(!0)+d[1]),e<0&&(d[0]+=e),f<0&&(d[1]+=f),this._$measureLabel.css({left:Math.max(d[0],0),top:Math.max(d[1],0)}).show())}},_resetDrawing:function(){this._drawPixels=[],this._drawCoords=[],this._$drawContainer.geographics("clear"),this._$measureLabel.hide()},_refreshAllShapes:function(a){this._timeoutRefreshShapes=null;for(var b,c,d=0;d<this._currentServices.length;d++)b=this._currentServices[d],a&&b.serviceContainer[0]!==a[0]||(c=b.serviceContainer.data("geoService"),c._createdGraphics&&(c._$shapesContainer.geographics("clear"),c._graphicShapes.length>0&&c._refreshShapes(c._$shapesContainer,c._graphicShapes,c._graphicShapes,c._graphicShapes)));this._createdGraphics&&!a&&(this._$shapesContainer.geographics("clear"),this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes))},_refreshShapes:function(b,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r=this._map._getBbox(g,h);for(i=0;i<d.length;i++)if(k=d[i].shape||d[i],k=k.geometry||k,!(l=a.data(k,"geoBbox"))||!a.geo._bboxDisjoint(r,l)){switch(m=a.isArray(e)?e[i].style:e,n=a.isArray(f)?f[i].label:f,o=n!==c,p=c,q=a.geo.centroid(k),k.type){case"Point":p=this._map.toPixel(k.coordinates,g,h),this._$shapesContainer.geographics("drawPoint",p,m);break;case"LineString":this._$shapesContainer.geographics("drawLineString",this._map.toPixel(k.coordinates,g,h),m),o&&(p=this._map.toPixel(a.geo.pointAlong(k,.5).coordinates,g,h));break;case"Polygon":this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(k.coordinates,g,h),m),o&&q&&(p=this._map.toPixel(q.coordinates,g,h));break;case"MultiPoint":for(j=0;j<k.coordinates.length;j++)this._$shapesContainer.geographics("drawPoint",this._map.toPixel(k.coordinates[j],g,h),m);o&&q&&(p=this._map.toPixel(q.coordinates,g,h));break;case"MultiLineString":for(j=0;j<k.coordinates.length;j++)this._$shapesContainer.geographics("drawLineString",this._map.toPixel(k.coordinates[j],g,h),m);o&&q&&(p=this._map.toPixel(q.coordinates,g,h));break;case"MultiPolygon":for(j=0;j<k.coordinates.length;j++)this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(k.coordinates[j],g,h),m);o&&q&&(p=this._map.toPixel(q.coordinates,g,h));break;case"GeometryCollection":this._refreshShapes(b,k.geometries,m,n,g,h)}o&&p&&this._$shapesContainer.geographics("drawLabel",p,n)}},_findMapSize:function(){for(var a={width:0,height:0},b=this._$elem;b.length&&!(a.width>0&&a.height>0);)a={width:b.width(),height:b.height()},(a.width<=0||a.height<=0)&&(a={width:parseInt(b.css("width"),10),height:parseInt(b.css("height"),10)}),b=b.parent();return a},_forcePosition:function(a){var b=a.css("position");"relative"!==b&&"absolute"!==b&&"fixed"!==b&&a.css("position","relative")},_getPixelSize:function(b){var c=this._options.tilingScheme;if(null!==c){if(0===b)return c.pixelSizes?c.pixelSizes[0]:c.basePixelSize;b=Math.round(b),b=Math.max(b,0);var d=c.pixelSizes?c.pixelSizes.length:c.levels;return b=Math.min(b,d-1),c.pixelSizes?c.pixelSizes[b]:c.basePixelSize/Math.pow(2,b)}var e=a.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._fullZoomFactor,b),!0);return Math.max(a.geo.width(e,!0)/this._contentBounds.width,a.geo.height(e,!0)/this._contentBounds.height)},_getZoomCenterAndSize:function(a,b,c){var d=c?this._fullZoomFactor:this._partialZoomFactor,e=Math.pow(d,-b),f=this._pixelSizeInteractive*e;this._options.tilingScheme&&(f=Math.min(Math.max(f,this._pixelSizeMin),this._pixelSizeMax));var g=this._getZoom(this._centerInteractive,f);c&&this._options.tilingScheme?f=this._getPixelSize(Math.min(Math.max(g,this._options.zoomMin),this._options.zoomMax)):b<0&&g<this._options.zoomMin?f=this._pixelSizeInteractive:b>0&&g>this._options.zoomMax&&(f=this._pixelSizeInteractive);var h=f/this._pixelSizeInteractive,i=this._toMap(a,this._centerInteractive,this._pixelSizeInteractive),j=[(this._centerInteractive[0]-i[0])*h,(this._centerInteractive[1]-i[1])*h];return{pixelSize:f,center:[i[0]+j[0],i[1]+j[1]]}},_panFinalize:function(){this._panning&&(this._velocity=[0,0],this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._inOp=!1,this._anchor=this._current,this._mouseDown=this._toolPan=this._panning=!1)},_panMove:function(){if(this._options.pannable){var a=this._current[0]-this._lastDrag[0],b=this._current[1]-this._lastDrag[1];(this._toolPan||a>3||a<-3||b>3||b<-3)&&(this._toolPan||(this._toolPan=!0,this._$eventTarget.css("cursor",this._options.cursors.pan)),this._mouseDown&&(this._velocity=[a,b]),0===a&&0===b||(this._panning=!0,this._lastDrag=this._current,this._centerInteractive[0]-=a*this._pixelSizeInteractive,this._centerInteractive[1]+=("image"===this._options.axisLayout?-1:1)*b*this._pixelSizeInteractive,this._setInteractiveCenterAndSize(this._centerInteractive,this._pixelSizeInteractive),this._interactiveTransform()))}},_clearInteractiveTimeout:function(){return this._timeoutRefreshShapes&&(clearTimeout(this._timeoutRefreshShapes),this._timeoutRefreshShapes=null),this._timeoutInteractive?(clearTimeout(this._timeoutInteractive),this._timeoutInteractive=null,!0):(this._centerInteractive[0]=this._center[0],this._centerInteractive[1]=this._center[1],this._pixelSizeInteractive=this._pixelSize,!1)},_interactiveTransform:function(){var b,c=this._pixelSize,d=c/this._pixelSizeInteractive;if(c>0){d=Math.round(1e3*d)/1e3;var e=this._toMap([0,0]),f=this._toPixel(e,this._centerInteractive,this._pixelSizeInteractive);this._$shapesContainers.geographics("interactiveTransform",f,d)}for(var g=0;g<this._currentServices.length;g++)b=this._currentServices[g],a.geo._serviceTypes[b.type].interactiveTransform(this,b,this._centerInteractive,this._pixelSizeInteractive);this._drawCoords.length>0&&(this._drawPixels=this._toPixel(this._drawCoords,this._centerInteractive,this._pixelSizeInteractive),this._refreshDrawing())},_interactiveTimeout:function(){this._isMultiTouch?this._timeoutInteractive=setTimeout(a.proxy(this._interactiveTimeout,this),128):this._created&&this._timeoutInteractive&&(this._setCenterAndSize(this._centerInteractive,this._pixelSizeInteractive,this._triggerInteractive,!0),this._timeoutInteractive=null,this._triggerInteractive=!1,this._timeoutRefreshShapes=setTimeout(a.proxy(this._refreshAllShapes,this),128))},_setInteractiveTimeout:function(b){this._timeoutInteractive=setTimeout(a.proxy(this._interactiveTimeout,this),128),this._triggerInteractive|=b},_refresh:function(b,c){for(var d,e=0;e<this._currentServices.length;e++)d=this._currentServices[e],c&&d.serviceContainer[0]!==c[0]||a.geo._serviceTypes[d.type].refresh(this,d,b)},_setInteractiveCenterAndSize:function(b,c){this._centerInteractive[0]=b[0],this._centerInteractive[1]=b[1],this._pixelSizeInteractive=c,this._userGeodetic?(this._options.bbox=a.geo.proj.toGeodetic(this._getBbox(b,c)),this._options.center=a.geo.proj.toGeodetic(b)):(this._options.bbox=this._getBbox(b,c),this._options.center[0]=b[0],this._options.center[1]=b[1]),this._options.pixelSize=c,this._options.zoom=this._getZoom(b,c)},_setCenterAndSize:function(c,d,e,f){if(a.isArray(c)&&2===c.length&&"number"==typeof c[0]&&"number"==typeof c[1]){var g=this._getZoom(c,d);this._options.tilingScheme?this._pixelSizeInteractive=d=this._getPixelSize(Math.min(Math.max(g,this._options.zoomMin),this._options.zoomMax)):g<this._options.zoomMin?this._pixelSizeInteractive=d=this._getPixelSize(this._options.zoomMin):g>this._options.zoomMax&&(this._pixelSizeInteractive=d=this._getPixelSize(this._options.zoomMax)),this._centerInteractive[0]=c[0],this._centerInteractive[1]=c[1],this._created&&this._interactiveTransform(),this._options.pixelSize=this._pixelSize=d,this._center[0]=c[0],this._center[1]=c[1],this._userGeodetic?(this._options.bbox=a.geo.proj.toGeodetic(this._getBbox()),this._options.center=a.geo.proj.toGeodetic(this._center)):(this._options.bbox=this._getBbox(),this._options.center=a.merge([],c)),this._options.zoom=g,e&&this._trigger("bboxchange",b.event,{bbox:a.merge([],this._options.bbox)}),f&&(this._refresh(),this._refreshAllShapes(),this._refreshDrawing())}},_requestQueued:function(){0===this._loadCount&&this._trigger("loadstart",b.event),this._loadCount++},_requestComplete:function(){--this._loadCount<=0&&(this._loadCount=0,this._trigger("loadend",b.event))},_toMap:function(b,c,d){c=c||this._center,d=d||this._pixelSize;var e,f,g,h,i=a.isArray(b[0]),j=i&&a.isArray(b[0][0]),k=j&&a.isArray(b[0][0][0]),l=this._contentBounds.width,m=this._contentBounds.height,n=l/2*d,o=m/2*d,p=[c[0]-n,c[1]-o,c[0]+n,c[1]+o],q=a.geo.width(p,!0)/l,r=a.geo.height(p,!0)/m,s="image"===this._options.axisLayout,t=[];for(k||(j||(i||(b=[b]),b=[b]),b=[b]),f=0;f<b.length;f++)for(t[f]=[],g=0;g<b[f].length;g++)for(t[f][g]=[],h=0;h<b[f][g].length;h++)e=b[f][g][h][1]*r,t[f][g][h]=[p[0]+b[f][g][h][0]*q,s?p[1]+e:p[3]-e];return k?t:j?t[0]:i?t[0][0]:t[0][0][0]},_toPixel:function(b,c,d){c=c||this._center,d=d||this._pixelSize;var e,f,g,h=a.isArray(b[0]),i=h&&a.isArray(b[0][0]),j=i&&a.isArray(b[0][0][0]),k=this._contentBounds.width,l=this._contentBounds.height,m=k/2*d,n=l/2*d,o=[c[0]-m,c[1]-n,c[0]+m,c[1]+n],p=a.geo.width(o,!0),q=a.geo.height(o,!0),r="image"===this._options.axisLayout,s=k/p,t=l/q,u=[];for(j||(i||(h||(b=[b]),b=[b]),b=[b]),e=0;e<b.length;e++)for(u[e]=[],f=0;f<b[e].length;f++)for(u[e][f]=[],g=0;g<b[e][f].length;g++)u[e][f][g]=[Math.round((b[e][f][g][0]-o[0])*s),Math.round((r?b[e][f][g][1]-o[1]:o[3]-b[e][f][g][1])*t)];return j?u:i?u[0]:h?u[0][0]:u[0][0][0]},_document_keydown:function(b){var c=this._drawCoords.length;c>0&&27===b.which&&(c<=2?(this._resetDrawing(),this._inOp=!1):(this._drawCoords[c-2]=a.merge([],this._drawCoords[c-1]),this._drawPixels[c-2]=a.merge([],this._drawPixels[c-1]),this._drawCoords.length--,this._drawPixels.length--,this._refreshDrawing()))},_eventTarget_dblclick_zoom:function(a){var b=this._clearInteractiveTimeout();if(this._trigger("dblclick",a,{type:"Point",coordinates:this._toMap(this._current,this._centerInteractive,this._pixelSizeInteractive)}),!a.isDefaultPrevented()){var c=this._getZoomCenterAndSize(this._current,1,!0);this._setInteractiveCenterAndSize(c.center,c.pixelSize),this._interactiveTransform(),b=!0}b&&this._setInteractiveTimeout(!0)},_eventTarget_dblclick:function(c){if("static"!==this._options.mode){switch(this._drawTimeout&&(b.clearTimeout(this._drawTimeout),this._drawTimeout=null),this._options.mode){case"drawLineString":case"measureLength":this._drawCoords.length>1&&(this._drawCoords[0][0]!==this._drawCoords[1][0]||this._drawCoords[0][1]!==this._drawCoords[1][1])?(this._drawCoords.length--,this._trigger("shape",c,{type:"LineString",coordinates:this._userGeodetic?a.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})):this._eventTarget_dblclick_zoom(c),this._resetDrawing();break;case"drawPolygon":case"measureArea":if(this._drawCoords.length>1&&(this._drawCoords[0][0]!==this._drawCoords[1][0]||this._drawCoords[0][1]!==this._drawCoords[1][1])){var d=this._drawCoords.length-1;d>2&&(this._drawCoords[d]=a.merge([],this._drawCoords[0]),this._trigger("shape",c,{type:"Polygon",coordinates:[this._userGeodetic?a.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]}))}else this._eventTarget_dblclick_zoom(c);this._resetDrawing();break;default:this._eventTarget_dblclick_zoom(c)}this._inOp=!1}},_eventTarget_touchstart:function(b){if(void 0!==document.elementFromPoint){var c=document.elementFromPoint(b.pageX,b.pageY);if(c&&"A"===c.nodeName)return}var d=this._options.mode,e=this._options.shift,f="dragBox"===d?"dragBox":"zoom";if("static"!==d&&(this._pointerEvents||this._supportTouch||1===b.which)){var g=this._clearInteractiveTimeout(),h=a(b.currentTarget).offset(),i=b.originalEvent.changedTouches;if(this._pointerEvents){if(!this._isMultiTouch&&this._mouseDown&&this._multiTouchAnchor.length>0)return b.currentTarget.setPointerCapture(b.originalEvent.pointerId),this._isMultiTouch=!0,this._wheelLevel=0,this._multiTouchAnchor.push(b.originalEvent),this._multiTouchCurrentBbox=[this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1],this._multiTouchAnchor[1].pageX-h.left,this._multiTouchAnchor[1].pageY-h.top],this._multiTouchAnchorBbox=a.merge([],this._multiTouchCurrentBbox),this._anchor=a.geo.center(this._multiTouchCurrentBbox,!0),this._current=a.merge([],this._anchor),g&&this._setInteractiveTimeout(!0),!1;this._multiTouchAnchor.length<2&&(b.currentTarget.setPointerCapture(b.originalEvent.pointerId),this._multiTouchAnchor.push(b.originalEvent),this._multiTouchCurrentBbox=[this._multiTouchAnchor[0].pageX-h.left,this._multiTouchAnchor[0].pageY-h.top,NaN,NaN],this._current=[this._multiTouchAnchor[0].pageX-h.left,this._multiTouchAnchor[0].pageY-h.top])}else this._supportTouch&&i?(this._multiTouchAnchor=a.merge([],i),this._isMultiTouch=this._multiTouchAnchor.length>1,this._isMultiTouch?(this._multiTouchCurrentBbox=[i[0].pageX-h.left,i[0].pageY-h.top,i[1].pageX-h.left,i[1].pageY-h.top],this._multiTouchAnchorBbox=a.merge([],this._multiTouchCurrentBbox),this._current=a.geo.center(this._multiTouchCurrentBbox,!0)):(this._multiTouchCurrentBbox=[i[0].pageX-h.left,i[0].pageY-h.top,NaN,NaN],this._current=[i[0].pageX-h.left,i[0].pageY-h.top])):this._current=[b.pageX-h.left,b.pageY-h.top];if(this._softDblClick){var j=a.now();if(j-this._downDate<750){if(this._isTap){var k=this._current[0]-this._anchor[0],l=this._current[1]-this._anchor[1];Math.sqrt(k*k+l*l)>8?this._isTap=!1:this._current=a.merge([],this._anchor)}this._isDbltap?this._isDbltap=!1:this._isDbltap=this._isTap}else this._isDbltap=!1;this._isTap=!0,this._downDate=j}return this._mouseDown=!0,this._anchor=a.merge([],this._current),!this._inOp&&b.shiftKey&&"off"!==e?(this._shiftDown=!0,this._$eventTarget.css("cursor",this._options.cursors["default"===e?f:e])):this._isMultiTouch||!this._options.pannable&&"dragBox"!==d&&"dragCircle"!==d||(this._inOp=!0,"zoom"!==d&&"dragBox"!==d&&"dragCircle"!==d&&(this._lastDrag=this._current,b.currentTarget.setCapture&&b.currentTarget.setCapture())),b.preventDefault(),g&&this._setInteractiveTimeout(!0),!1}},_dragTarget_touchmove:function(b){if("static"!==this._options.mode){var c=!1;this._mouseDown&&(c=this._clearInteractiveTimeout());var d,f,g,h,i,j,k=this._$eventTarget.offset(),l=this._drawCoords.length,m=b.originalEvent.changedTouches,n=null;if(this._pointerEvents)if(this._isMultiTouch){if(b.originalEvent.pointerId===this._multiTouchAnchor[0].pointerId)this._multiTouchCurrentBbox[0]=b.originalEvent.pageX-k.left,this._multiTouchCurrentBbox[1]=b.originalEvent.pageY-k.top;else{if(b.originalEvent.pointerId!==this._multiTouchAnchor[1].pointerId)return b.preventDefault(),c&&this._setInteractiveTimeout(!0),!1;this._multiTouchCurrentBbox[2]=b.originalEvent.pageX-k.left,this._multiTouchCurrentBbox[3]=b.originalEvent.pageY-k.top}d=a.geo._distancePointPoint([this._multiTouchAnchorBbox[0],this._multiTouchAnchorBbox[1]],[this._multiTouchAnchorBbox[2],this._multiTouchAnchorBbox[3]]),f=a.geo._distancePointPoint([this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1]],[this._multiTouchCurrentBbox[2],this._multiTouchCurrentBbox[3]]),g=(f-d)/d,g*=g>0?5:10,h=g-this._wheelLevel,this._wheelLevel=g,i=this._getZoomCenterAndSize(this._anchor,h,!1),this._setInteractiveCenterAndSize(i.center,i.pixelSize),this._interactiveTransform(),c=!0,n=a.geo.center(this._multiTouchCurrentBbox,!0)}else this._multiTouchAnchor[0]=b.originalEvent,this._multiTouchCurrentBbox=[this._multiTouchAnchor[0].pageX-k.left,this._multiTouchAnchor[0].pageY-k.top,NaN,NaN],n=[b.originalEvent.pageX-k.left,b.originalEvent.pageY-k.top];else if(this._supportTouch&&m){if(!this._isMultiTouch&&this._mouseDown&&this._multiTouchAnchor.length>0&&m[0].identifier!==this._multiTouchAnchor[0].identifier)return this._isMultiTouch=!0,this._wheelLevel=0,this._multiTouchAnchor.push(m[0]),this._multiTouchCurrentBbox=[this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1],this._multiTouchAnchor[1].pageX-k.left,this._multiTouchAnchor[1].pageY-k.top],this._multiTouchAnchorBbox=a.merge([],this._multiTouchCurrentBbox),this._anchor=this._current=a.geo.center(this._multiTouchCurrentBbox,!0),c&&this._setInteractiveTimeout(!0),!1;if(this._isMultiTouch){for(j=0;j<m.length;j++)m[j].identifier===this._multiTouchAnchor[0].identifier?(this._multiTouchCurrentBbox[0]=m[j].pageX-k.left,this._multiTouchCurrentBbox[1]=m[j].pageY-k.top):m[j].identifier===this._multiTouchAnchor[1].identifier&&(this._multiTouchCurrentBbox[2]=m[j].pageX-k.left,this._multiTouchCurrentBbox[3]=m[j].pageY-k.top);d=a.geo._distancePointPoint([this._multiTouchAnchorBbox[0],this._multiTouchAnchorBbox[1]],[this._multiTouchAnchorBbox[2],this._multiTouchAnchorBbox[3]]),f=a.geo._distancePointPoint([this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1]],[this._multiTouchCurrentBbox[2],this._multiTouchCurrentBbox[3]]),g=(f-d)/d,g*=g>0?5:10,h=g-this._wheelLevel,this._wheelLevel=g,i=this._getZoomCenterAndSize(this._anchor,h,!1),this._setInteractiveCenterAndSize(i.center,i.pixelSize),this._interactiveTransform(),c=!0,n=a.geo.center(this._multiTouchCurrentBbox,!0)}else n=[b.originalEvent.changedTouches[0].pageX-k.left,b.originalEvent.changedTouches[0].pageY-k.top]}else n=[b.pageX-k.left,b.pageY-k.top];if(null===n)return b.preventDefault(),c&&this._setInteractiveTimeout(!0),!1;if(n[0]===this._lastMove[0]&&n[1]===this._lastMove[1])return!!this._inOp&&(b.preventDefault(),c&&this._setInteractiveTimeout(!0),!1);if(7===e&&(this._isDbltap=this._isTap=!1),this._mouseDown&&(this._current=n,this._moveDate=a.now()),this._isMultiTouch)return b.preventDefault(),this._isDbltap=this._isTap=!1,c&&this._setInteractiveTimeout(!0),!1;var o,p,q,r=this._options.mode,s=this._options.shift,t="dragBox"===r?"dragBox":"zoom";switch(this._shiftDown&&(r="default"===s?t:s),r){case"zoom":case"dragBox":this._mouseDown?(this._$drawContainer.geographics("clear"),this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],n[0],n[1]])):this._trigger("move",b,{type:"Point",coordinates:this.toMap(n)});break;case"dragCircle":this._mouseDown?(o=n[0]-this._anchor[0],p=n[1]-this._anchor[1],q=2*Math.sqrt(o*o+p*p),this._$drawContainer.geographics("clear"),this._$drawContainer.geographics("drawArc",this._anchor,0,360,{width:q,height:q})):this._trigger("move",b,{type:"Point",coordinates:this.toMap(n)});break;case"drawLineString":case"drawPolygon":case"measureLength":case"measureArea":this._mouseDown||this._toolPan?(this._panMove(),c=!0):(l>0&&(this._drawCoords[l-1]=this._toMap(n,this._centerInteractive,this._pixelSizeInteractive),this._drawPixels[l-1]=n,this._refreshDrawing()),this._trigger("move",b,{type:"Point",coordinates:this.toMap(n)}));break;default:this._mouseDown||this._toolPan?(this._panMove(),c=!0):this._trigger("move",b,{type:"Point",coordinates:this.toMap(n)})}return this._lastMove=n,c&&this._setInteractiveTimeout(!0),this._inOp?(b.preventDefault(),!1):void 0}},_dragTarget_touchstop:function(c){if("static"!==this._options.mode){if(!this._mouseDown){if(7!==e)return;this._eventTarget_touchstart(c)}var d,f,g,h,i,j,k=this._clearInteractiveTimeout(),l=this._mouseDown,m=this._toolPan,n=this._$eventTarget.offset(),o=this._options.mode,p=this._options.shift,q="dragBox"===o?"dragBox":"zoom",r=null;if(this._shiftDown&&(o="default"===p?q:p),this._pointerEvents){if(c.originalEvent.pointerId!==this._multiTouchAnchor[0].pointerId&&c.originalEvent.pointerId!==this._multiTouchAnchor[1].pointerId)return c.preventDefault(),void(k&&this._setInteractiveTimeout(!0));c.currentTarget.releasePointerCapture(c.originalEvent.pointerId),r=[c.originalEvent.pageX-n.left,c.originalEvent.pageY-n.top],this._multiTouchAnchor=[],this._inOp=!1}else this._supportTouch&&c.originalEvent.changedTouches?(r=[c.originalEvent.changedTouches[0].pageX-n.left,c.originalEvent.changedTouches[0].pageY-n.top],this._multiTouchAnchor=[],this._inOp=!1):r=[c.pageX-n.left,c.pageY-n.top];if(this._softDblClick&&this._isTap&&(g=r[0]-this._anchor[0],h=r[1]-this._anchor[1],Math.sqrt(g*g+h*h)<=8&&(r=a.merge([],this._anchor))),g=r[0]-this._anchor[0],h=r[1]-this._anchor[1],this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._shiftDown=this._mouseDown=this._toolPan=!1,this._isMultiTouch)return c.preventDefault(),this._isMultiTouch=!1,this._wheelLevel=0,void(k&&this._setInteractiveTimeout(!0));if(document.releaseCapture&&document.releaseCapture(),l){switch(f=a.now(),this._current=r,o){case"zoom":case"dragBox":if(0!==g||0!==h){var s=6*this._pixelSize,t=this._toMap([this._anchor,r]),u=[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])];"zoom"===o?(u[2]-u[0]<s&&u[3]-u[1]<s&&(u=a.geo.scaleBy(this._getBbox(a.geo.center(u,!0)),.5,!0)),this._setBbox(u,!0,!0),k=!0):(j=a.geo.polygonize(u,!0),j.bbox=u,this._userGeodetic&&(j.coordinates=a.geo.proj.toGeodetic(j.coordinates),j.bbox=a.geo.proj.toGeodetic(j.bbox)),this._trigger("shape",c,j))}else"dragBox"===o&&(i=this._toMap(r),j={type:"Point",coordinates:[i[0],i[1]],bbox:[i[0],i[1],i[0],i[1]]},this._userGeodetic&&(j.coordinates=a.geo.proj.toGeodetic(j.coordinates),j.bbox=a.geo.proj.toGeodetic(j.bbox)),this._trigger("shape",c,j));this._resetDrawing();break;case"dragCircle":if(0!==g||0!==h){var v,w="image"===this._options.axisLayout,x=Math.sqrt(g*g+h*h),y=180;for(this._drawPixels.length=y+1,d=0;d<y;d++)v=360*d/y*(Math.PI/180),this._drawPixels[d]=[this._anchor[0]+Math.cos(v)*x,this._anchor[1]+Math.sin(v)*x];this._drawPixels[y]=[this._drawPixels[0][0],this._drawPixels[0][1]],i=this._toMap([[this._anchor[0]-x,this._anchor[1]+(w?-x:x)],[this._anchor[0]+x,this._anchor[1]+(w?x:-x)]]),j={type:"Polygon",coordinates:[this._toMap(this._drawPixels)],bbox:[i[0][0],i[0][1],i[1][0],i[1][1]]},this._userGeodetic&&(j.coordinates=a.geo.proj.toGeodetic(j.coordinates),j.bbox=a.geo.proj.toGeodetic(j.bbox)),this._trigger("shape",c,j),this._resetDrawing()}else i=this._toMap(r),j={type:"Point",coordinates:[i[0],i[1]],bbox:[i[0],i[1],i[0],i[1]]},this._userGeodetic&&(j.coordinates=a.geo.proj.toGeodetic(j.coordinates),j.bbox=a.geo.proj.toGeodetic(j.bbox)),this._trigger("shape",c,j);break;case"drawPoint":if(this._drawTimeout&&(b.clearTimeout(this._drawTimeout),this._drawTimeout=null),m)this._panFinalize();else if(f-this._clickDate>100){var z=this;this._drawTimeout=setTimeout(function(){z._drawTimeout&&(z._trigger("shape",c,{type:"Point",coordinates:z.toMap(r)}),z._inOp=!1,z._drawTimeout=null)},250)}break;case"drawLineString":case"drawPolygon":case"measureLength":case"measureArea":m?this._panFinalize():(this._trigger("click",c,{type:"Point",coordinates:this.toMap(r)}),c.isDefaultPrevented()||(d=0===this._drawCoords.length?0:this._drawCoords.length-1,this._drawCoords[d]=this._toMap(r),this._drawPixels[d]=r,(d<2||this._drawCoords[d][0]!==this._drawCoords[d-1][0]||this._drawCoords[d][1]!==this._drawCoords[d-1][1])&&(this._drawCoords[d+1]=this._toMap(r,this._centerInteractive,this._pixelSizeInteractive),this._drawPixels[d+1]=r),this._refreshDrawing()));break;default:m?this._panFinalize():f-this._clickDate>100&&(this._trigger("click",c,{type:"Point",coordinates:this.toMap(r)}),this._inOp=!1)}if(this._clickDate=f,
this._softDblClick&&this._isDbltap)return this._isDbltap=this._isTap=!1,k&&this._setInteractiveTimeout(!0),this._$eventTarget.trigger("softdblclick",c),!1}return k&&this._setInteractiveTimeout(!0),this._inOp?(c.preventDefault(),!1):void 0}},_eventTarget_mousewheel:function(b){if("static"!==this._options.mode&&"off"!==this._options.scroll){if(b.preventDefault(),this._mouseDown)return!1;if(0!==b.deltaY){this._timeoutWheel&&(clearTimeout(this._timeoutWheel),this._timeoutWheel=null);var c=this,d=b.currentTarget,e=b.deltaY,f=b.pageX,g=b.pageY;this._timeoutWheel=setTimeout(function(){c._clearInteractiveTimeout();var b=e>0?1:-1,h=a(d).offset();c._anchor=[f-h.left,g-h.top];var i=c._getZoomCenterAndSize(c._anchor,b,null!==c._options.tilingScheme);c._setInteractiveCenterAndSize(i.center,i.pixelSize),c._interactiveTransform(),c._setInteractiveTimeout(!0)},30)}return!1}}})}(jQuery,window),function(a,b,c){a.geo._serviceTypes.tiled=function(){var c=new RegExp("<.*>|{{.*}}");return{_serviceId:0,_tmplGeoSrcId:"",create:function(c,d,e){this._serviceId=c._serviceIdSeed++,this._tmplGeoSrcId="geoSrc"+this._serviceId;var f=a.data(e,"geoServiceState");if(!f){f={loadCount:0,reloadTiles:!1};d.append(b.toStaticHTML('<div data-geo-service="tiled" style="-webkit-transform:translateZ(0); position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0;"></div>')),f.serviceContainer=d.children(":last"),a.data(e,"geoServiceState",f)}return f.serviceContainer},destroy:function(b,c,d){a.data(d,"geoServiceState").serviceContainer.remove(),a.removeData(d,"geoServiceState")},interactiveTransform:function(b,c,d,e){var f=a.data(c,"geoServiceState"),g=b.options.tilingScheme;f&&(this._cancelUnloaded(b,c),f.serviceContainer.children().each(function(){var c=a(this),f=c.data("pixelSize"),h=f/e;if(f>0){h=Math.round(1e3*h)/1e3;var i=c.data("scaleOrigin"),j=b._toPixel(i,d,e);c.css({left:Math.round(j[0])+"px",top:Math.round(j[1])+"px",width:g.tileWidth*h,height:g.tileHeight*h})}}))},refresh:function(d,e,f){var g=a.data(e,"geoServiceState");if(this._cancelUnloaded(d,e),g&&f&&(g.reloadTiles=!0),g&&e&&"visible"===e.style.visibility&&!g.serviceContainer.is(":hidden")){var h,i,j=d._getBbox(),k=d._pixelSize,l=this,m=g.serviceContainer,n="image"===d.options.axisLayout,o=n?1:-1,p=d.options.tilingScheme,q=p.tileWidth,r=p.tileHeight,s=Math.floor((j[0]-p.origin[0])/(k*q)),t=Math.max(Math.floor((n?j[1]-p.origin[1]:p.origin[1]-j[3])/(k*r)),0),u=Math.ceil((j[2]-p.origin[0])/(k*q)),v=Math.ceil((n?j[3]-p.origin[1]:p.origin[1]-j[1])/(k*r)),w=d._getBboxMax(),x=d._getPixelSize(0),y=x/k,z=Math.floor((w[0]-p.origin[0])/(x*q))*y,A=Math.floor((p.origin[1]+o*w[3])/(x*r))*y,B=p.origin[0]+z*q*k,C=p.origin[1]+o*(A*r)*k,D=Math.round((B-j[0])/k),E=Math.round((n?C-j[1]:j[3]-C)/k),F=m.children().show(),G=F.filter("[data-pixel-size='"+k+"']").appendTo(m),H=e.style.opacity,I=function(a){l._loadImage(this.img,a,k,d,g,H)},J=function(){delete this.img,g.loadCount--,d._requestComplete()};for(g.reloadTiles&&F.find("img").attr("data-dirty","true"),G.length?(G.css({left:D%q+"px",top:E%r+"px"}).data("scaleOrigin",d._toMap([D%q,E%r])),G.children().each(function(){var b=a(this),c=b.attr("data-tile").split(",");b.css({left:Math.round(100*(parseInt(c[0],10)-z)+(D-D%q)/q*100)+"%",top:Math.round(100*(parseInt(c[1],10)-A)+(E-E%r)/r*100)+"%"}),H<1&&b.fadeTo(0,H)})):(m.append(b.toStaticHTML("<div style='-webkit-transform:translateZ(0);position:absolute; left:"+D%q+"px; top:"+E%r+"px; width:"+q+"px; height:"+r+"px; margin:0; padding:0;' data-pixel-size='"+k+"'></div>")),G=m.children(":last").data("scaleOrigin",d._toMap([D%q,E%r]))),h=s;h<u;h++)for(i=t;i<v;i++){var K=h+","+i,L=G.children("[data-tile='"+K+"']").removeAttr("data-dirty");if(0===L.length||g.reloadTiles){var M,N=[p.origin[0]+h*q*k,p.origin[1]+o*(i*r)*k],O=[p.origin[0]+((h+1)*q-1)*k,p.origin[1]+o*((i+1)*r-1)*k],P=[N[0],N[1],O[0],O[1]],Q={bbox:P,width:q,height:r,zoom:d._getZoom(),tile:{row:i,column:h},index:Math.abs(i+h)},R=a.isFunction(e.src);if(R?M=e.src(Q):c.test(e.src)?(a.templates(this._tmplGeoSrcId,e.src),M=a.render[this._tmplGeoSrcId](Q)):M=e.src,g.loadCount++,d._requestQueued(),g.reloadTiles&&L.length>0)L.attr("src",M);else{var S="<img style='-webkit-transform:translateZ(0);position:absolute; left:"+(100*(h-z)+(D-D%q)/q*100)+"%; top:"+(100*(i-A)+(E-E%r)/r*100)+"%; ";S+="width: 100%; height: 100%;",S+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+K+"' />",G.append(b.toStaticHTML(S)),L=G.children(":last")}"string"==typeof M?l._loadImage(L,M,k,d,g,H):M&&a.isFunction(M.promise)?(a.extend(M.promise(),{img:L}),M.done(I).fail(J)):L.remove()}}F.find("[data-dirty]").remove(),g.reloadTiles=!1}},resize:function(){},opacity:function(b,c){a.data(c,"geoServiceState").serviceContainer.find("img").stop(!0).fadeTo("fast",c.style.opacity)},toggle:function(b,c){a.data(c,"geoServiceState").serviceContainer.css("display","visible"===c.style.visibility?"block":"none")},_cancelUnloaded:function(b,c){var d=a.data(c,"geoServiceState");if(d&&d.loadCount>0)for(d.serviceContainer.find("img:hidden").remove();d.loadCount>0;)d.loadCount--,b._requestComplete()},_loadImage:function(b,c,d,e,f,g){var h=f.serviceContainer;b.on("load",function(b){g<1?a(b.target).fadeTo(0,g):a(b.target).show(),f.loadCount--,e._requestComplete(),f.loadCount<=0&&(h.children(":not([data-pixel-size='"+d+"'])").remove(),f.loadCount=0)}).on("error",function(b){a(b.target).remove(),f.loadCount--,e._requestComplete(),f.loadCount<=0&&(h.children(":not([data-pixel-size='"+d+"'])").remove(),f.loadCount=0)}).attr("src",c)}}}()}(jQuery,window),function(a,b,c){a.geo._serviceTypes.shingled=function(){var c=new RegExp("<.*>|{{.*}}");return{_serviceId:0,_tmplGeoSrcId:"",create:function(c,d,e){this._serviceId=c._serviceIdSeed++,this._tmplGeoSrcId="geoSrc"+this._serviceId;var f=a.data(e,"geoServiceState");if(!f){f={loadCount:0};d.append(b.toStaticHTML('<div data-geo-service="shingled" style="-webkit-transform:translateZ(0);position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0;"></div>')),f.serviceContainer=d.children(":last"),a.data(e,"geoServiceState",f)}return f.serviceContainer},destroy:function(b,c,d){a.data(d,"geoServiceState").serviceContainer.remove(),a.removeData(d,"geoServiceState")},interactiveTransform:function(b,c,d,e){var f=a.data(c,"geoServiceState"),g=b._getContentBounds(),h=g.width,i=g.height;f&&(this._cancelUnloaded(b,c),f.serviceContainer.children().each(function(){var c=a(this),f=c.data("pixelSize"),g=f/e;if(f>0){g=Math.round(1e3*g)/1e3;var j=c.data("origin"),k=b._toPixel(j,d,e);c.css({left:Math.round(k[0]),top:Math.round(k[1]),width:h*g,height:i*g})}}))},refresh:function(d,e,f){var g=a.data(e,"geoServiceState");if(this._cancelUnloaded(d,e),g&&e&&"visible"===e.style.visibility&&!g.serviceContainer.is(":hidden")){var h,i=d._getBbox(),j=d._pixelSize,k=this,l=g.serviceContainer,m=d._getContentBounds(),n=m.width,o=m.height,p=l.children('[data-pixel-size="'+j+'"]'),q=e.style.opacity;q<1||f||1===e.shinglesMax?l.find("img").attr("data-keep-alive","0"):e.shinglesMax>1&&l.find("img").slice(0,-(e.shinglesMax-1)).attr("data-keep-alive","0"),p.length||(l.append(b.toStaticHTML('<div style="-webkit-transform:translateZ(0);position:absolute; left:0px; top: 0px; width:'+n+"px; height:"+o+'px; margin:0; padding:0;" data-pixel-size="'+j+'" data-origin="['+d._toMap([0,0])+']"></div>')),p=l.children(":last"));var r,s={bbox:i,width:n,height:o,zoom:d._getZoom(),tile:null,index:0},t=a.isFunction(e.src),u=p.position();u.left=-u.left,u.top=-u.top,t?r=e.src(s):c.test(e.src)?(a.templates(this._tmplGeoSrcId,e.src),r=a.render[this._tmplGeoSrcId](s)):r=e.src,g.loadCount++,d._requestQueued(),p.append(b.toStaticHTML('<img style="-webkit-transform:translateZ(0);position:absolute; left:'+u.left/p.width()*100+"%; top:"+u.top/p.height()*100+'%; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />')),h=p.children(":last").data("center",d._center),"string"==typeof r?k._loadImage(h,r,j,d,g,q):r&&r.done(function(a){k._loadImage(h,a,j,d,g,q)}).fail(function(){h.remove(),g.loadCount--,d._requestComplete()})}},resize:function(b,c){var d=a.data(c,"geoServiceState");if(d&&c&&"visible"===c.style.visibility){this._cancelUnloaded(b,c);var e=d.serviceContainer,f=b._getContentBounds(),g=f.width,h=f.height,i=e.children();i.attr("data-pixel-size","0"),i.each(function(){var b=a(this),c=b.position();b.css({left:c.left+(g-b.width())/2,top:c.top+(h-b.height())/2})})}},opacity:function(b,c){a.data(c,"geoServiceState").serviceContainer.find("img").stop(!0).fadeTo("fast",c.style.opacity)},toggle:function(b,c){a.data(c,"geoServiceState").serviceContainer.css("display","visible"===c.style.visibility?"block":"none")},_cancelUnloaded:function(b,c){var d=a.data(c,"geoServiceState");if(d&&d.loadCount>0)for(d.serviceContainer.find("img:hidden").remove();d.loadCount>0;)d.loadCount--,b._requestComplete()},_loadImage:function(b,c,d,e,f,g){var h=f.serviceContainer;b.on("load",function(b){a.contains(document.body,b.target.jquery?b.target[0]:b.target)&&(g<1?a(b.target).fadeTo(0,g):a(b.target).show(),f.loadCount--,e._requestComplete(),f.loadCount<=0&&(h.children(':not([data-pixel-size="'+d+'"])').remove(),h.find("img[data-keep-alive]").remove(),f.loadCount=0))}).on("error",function(b){a.contains(document.body,b.target.jquery?b.target[0]:b.target)&&(a(b.target).remove(),f.loadCount--,e._requestComplete(),f.loadCount<=0&&(h.children(":not([data-pixel-size='"+d+"'])").remove(),f.loadCount=0))}).attr("src",c)}}}()}(jQuery,window);